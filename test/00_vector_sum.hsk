-- Vector sum with multiple supers

sum_list xs =
  case xs of
    []      -> 0;
    y:ys    -> y + sum_list ys;;

chunk2 xs =
  case xs of
    []        -> [];
    a:b:rest  -> [a, b] : chunk2 rest;
    _         -> [xs];;

-- First super: takes a list xs and returns a singleton list [sum xs]
sum_chunk xs =
  super single input (xs) output (r)
#BEGINSUPER
    r = [sum xs]
#ENDSUPER;

-- Second super: acts as an identity on the list (just to exercise multiple supers)
sum_chunks xss =
  super parallel input (xss) output (rs)
#BEGINSUPER
    rs = xss
#ENDSUPER;

vector_sum xs =
  let parts     = chunk2 xs;
      partials  = sum_chunks parts
  in sum_list partials;

main =
  vector_sum [1,2,3,4,5,6]
