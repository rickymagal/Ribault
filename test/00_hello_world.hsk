-- Vector sum with printing inside a super

init_vec dummy =
  super single input (dummy) output (xs)
#BEGINSUPER
    xs = [0 .. 99]
#ENDSUPER

fill_pairs xs =
  super parallel input (xs) output (pairs)
#BEGINSUPER
    pairs = map (\x -> encPair x (x + 1)) xs
#ENDSUPER

add_pairs pairs =
  super parallel input (pairs) output (cs)
#BEGINSUPER
    cs = map (\p -> fstDec p + sndDec p) pairs
#ENDSUPER

print_final cs =
  super single input (cs) output (out)
#BEGINSUPER
    out = unsafePerformIO
      (do
        print "Hello World!"
        print cs
        pure [0])
#ENDSUPER

main =
  print_final (add_pairs (fill_pairs (init_vec [])))
