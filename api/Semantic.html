<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Semantic</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">Ribault &#8212; Compiler API Docs</span><ul class="links" id="page-menu"><li><a href="src/Semantic.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td></td></tr><tr><th>License</th><td></td></tr><tr><th>Maintainer</th><td>ricardofilhoschool@gmail.com</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Portability</th><td>portable</td></tr><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr></table><p class="caption">Semantic</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>## Overview</p><p>This module provides:</p><ol><li value="1">**Semantic checking** (non-typing): undefined variables, arity mismatches,
   duplicate function names, duplicate parameters, and duplicate pattern vars.</li><li value="2">**Lightweight type inference** over a small type algebra (lists, tuples,
   functions, literals, basic unary/binary operators).</li><li value="3">**Utilities**: a tiny desugaring (turns <code>f = \ps -&gt; e</code> into <code>f ps = e</code>),
   and a pass to assign fresh names to <code><a href="Syntax.html#v:Super" title="Syntax">Super</a></code> blocks.</li></ol><p>## Notes</p><ul><li>Application trees are flattened left-associatively for both checks and inference.</li><li>The type inference uses ad-hoc unification helpers; it is not general HM.</li><li>Only top-level function declarations exist in <code><a href="Syntax.html#t:Program" title="Syntax">Program</a></code>.</li><li>In <code><a href="Syntax.html#v:Let" title="Syntax">Let</a></code>, only function declarations are (optionally) given local types.</li></ul></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:desugarDecl">desugarDecl</a> :: <a href="Syntax.html#t:Decl" title="Syntax">Decl</a> -&gt; <a href="Syntax.html#t:Decl" title="Syntax">Decl</a></li><li class="src short"><a href="#v:desugarProgram">desugarProgram</a> :: <a href="Syntax.html#t:Program" title="Syntax">Program</a> -&gt; <a href="Syntax.html#t:Program" title="Syntax">Program</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:SemanticError">SemanticError</a><ul class="subs"><li>= <a href="#v:UndefinedVar">UndefinedVar</a> <a href="Syntax.html#t:Ident" title="Syntax">Ident</a></li><li>| <a href="#v:ArityMismatch">ArityMismatch</a> <a href="Syntax.html#t:Ident" title="Syntax">Ident</a> Int Int</li><li>| <a href="#v:DuplicateFunc">DuplicateFunc</a> <a href="Syntax.html#t:Ident" title="Syntax">Ident</a></li><li>| <a href="#v:DuplicateParam">DuplicateParam</a> <a href="Syntax.html#t:Ident" title="Syntax">Ident</a></li><li>| <a href="#v:DuplicatePatternVar">DuplicatePatternVar</a> <a href="Syntax.html#t:Ident" title="Syntax">Ident</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:TypeError">TypeError</a><ul class="subs"><li>= <a href="#v:Mismatch">Mismatch</a> <a href="Syntax.html#t:Expr" title="Syntax">Expr</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></li><li>| <a href="#v:CondNotBool">CondNotBool</a> <a href="Syntax.html#t:Expr" title="Syntax">Expr</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></li><li>| <a href="#v:BranchesTypeDiffer">BranchesTypeDiffer</a> <a href="Syntax.html#t:Expr" title="Syntax">Expr</a> <a href="Syntax.html#t:Expr" title="Syntax">Expr</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></li><li>| <a href="#v:BinOpTypeErr">BinOpTypeErr</a> <a href="Syntax.html#t:BinOperator" title="Syntax">BinOperator</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></li><li>| <a href="#v:UnOpTypeErr">UnOpTypeErr</a> <a href="Syntax.html#t:UnOperator" title="Syntax">UnOperator</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></li><li>| <a href="#v:UnknownVar">UnknownVar</a> <a href="Syntax.html#t:Ident" title="Syntax">Ident</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:Error">Error</a><ul class="subs"><li>= <a href="#v:SemErr">SemErr</a> <a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a></li><li>| <a href="#v:TypErr">TypErr</a> <a href="Semantic.html#t:TypeError" title="Semantic">TypeError</a></li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:Sig">Sig</a> = Map <a href="Syntax.html#t:Ident" title="Syntax">Ident</a> Int</li><li class="src short"><span class="keyword">type</span> <a href="#t:Env">Env</a> = Set <a href="Syntax.html#t:Ident" title="Syntax">Ident</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:Type">Type</a><ul class="subs"><li>= <a href="#v:TInt">TInt</a></li><li>| <a href="#v:TFloat">TFloat</a></li><li>| <a href="#v:TBool">TBool</a></li><li>| <a href="#v:TChar">TChar</a></li><li>| <a href="#v:TString">TString</a></li><li>| <a href="#v:TList">TList</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></li><li>| <a href="#v:TTuple">TTuple</a> [<a href="Semantic.html#t:Type" title="Semantic">Type</a>]</li><li>| <a href="#v:TVar">TVar</a> String</li><li>| <a href="#v:TFun">TFun</a> [<a href="Semantic.html#t:Type" title="Semantic">Type</a>] <a href="Semantic.html#t:Type" title="Semantic">Type</a></li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:TypeEnv">TypeEnv</a> = Map <a href="Syntax.html#t:Ident" title="Syntax">Ident</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:FuncEnv">FuncEnv</a> = Map <a href="Syntax.html#t:Ident" title="Syntax">Ident</a> ([<a href="Semantic.html#t:Type" title="Semantic">Type</a>], <a href="Semantic.html#t:Type" title="Semantic">Type</a>)</li><li class="src short"><span class="keyword">data</span> <a href="#t:InferState">InferState</a> = <a href="#v:InferState">InferState</a> {<ul class="subs"><li><a href="#v:count">count</a> :: Int</li></ul>}</li><li class="src short"><span class="keyword">type</span> <a href="#t:Infer">Infer</a> a = ExceptT <a href="Semantic.html#t:TypeError" title="Semantic">TypeError</a> (State <a href="Semantic.html#t:InferState" title="Semantic">InferState</a>) a</li><li class="src short"><a href="#v:buildSig">buildSig</a> :: [<a href="Syntax.html#t:Decl" title="Syntax">Decl</a>] -&gt; <a href="Semantic.html#t:Sig" title="Semantic">Sig</a></li><li class="src short"><a href="#v:buildFuncEnv">buildFuncEnv</a> :: [<a href="Syntax.html#t:Decl" title="Syntax">Decl</a>] -&gt; <a href="Semantic.html#t:FuncEnv" title="Semantic">FuncEnv</a></li><li class="src short"><a href="#v:semanticCheck">semanticCheck</a> :: <a href="Syntax.html#t:Program" title="Syntax">Program</a> -&gt; [<a href="Semantic.html#t:Error" title="Semantic">Error</a>]</li><li class="src short"><a href="#v:checkDecl">checkDecl</a> :: <a href="Semantic.html#t:Sig" title="Semantic">Sig</a> -&gt; <a href="Syntax.html#t:Decl" title="Syntax">Decl</a> -&gt; [<a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a>]</li><li class="src short"><a href="#v:checkExpr">checkExpr</a> :: <a href="Semantic.html#t:Sig" title="Semantic">Sig</a> -&gt; <a href="Semantic.html#t:Env" title="Semantic">Env</a> -&gt; <a href="Syntax.html#t:Expr" title="Syntax">Expr</a> -&gt; [<a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a>]</li><li class="src short"><a href="#v:checkAlt">checkAlt</a> :: <a href="Semantic.html#t:Sig" title="Semantic">Sig</a> -&gt; <a href="Semantic.html#t:Env" title="Semantic">Env</a> -&gt; (<a href="Syntax.html#t:Pattern" title="Syntax">Pattern</a>, <a href="Syntax.html#t:Expr" title="Syntax">Expr</a>) -&gt; [<a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a>]</li><li class="src short"><a href="#v:flattenApp">flattenApp</a> :: <a href="Syntax.html#t:Expr" title="Syntax">Expr</a> -&gt; (<a href="Syntax.html#t:Expr" title="Syntax">Expr</a>, [<a href="Syntax.html#t:Expr" title="Syntax">Expr</a>])</li><li class="src short"><a href="#v:patVars">patVars</a> :: <a href="Syntax.html#t:Pattern" title="Syntax">Pattern</a> -&gt; [<a href="Syntax.html#t:Ident" title="Syntax">Ident</a>]</li><li class="src short"><a href="#v:checkProgram">checkProgram</a> :: <a href="Syntax.html#t:Program" title="Syntax">Program</a> -&gt; [<a href="Semantic.html#t:Error" title="Semantic">Error</a>]</li><li class="src short"><a href="#v:unifyReturn">unifyReturn</a> :: <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Infer" title="Semantic">Infer</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></li><li class="src short"><a href="#v:isTVar">isTVar</a> :: <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; Bool</li><li class="src short"><a href="#v:inferExpr">inferExpr</a> :: <a href="Semantic.html#t:FuncEnv" title="Semantic">FuncEnv</a> -&gt; <a href="Semantic.html#t:TypeEnv" title="Semantic">TypeEnv</a> -&gt; <a href="Syntax.html#t:Expr" title="Syntax">Expr</a> -&gt; <a href="Semantic.html#t:Infer" title="Semantic">Infer</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></li><li class="src short"><a href="#v:match">match</a> :: <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; Bool</li><li class="src short"><a href="#v:resolve">resolve</a> :: <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a></li><li class="src short"><a href="#v:inferPattern">inferPattern</a> :: <a href="Syntax.html#t:Pattern" title="Syntax">Pattern</a> -&gt; <a href="Semantic.html#t:Infer" title="Semantic">Infer</a> ([(<a href="Syntax.html#t:Ident" title="Syntax">Ident</a>, <a href="Semantic.html#t:Type" title="Semantic">Type</a>)], <a href="Semantic.html#t:Type" title="Semantic">Type</a>)</li><li class="src short"><a href="#v:literalType">literalType</a> :: <a href="Syntax.html#t:Literal" title="Syntax">Literal</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a></li><li class="src short"><a href="#v:numBin">numBin</a> :: <a href="Syntax.html#t:BinOperator" title="Syntax">BinOperator</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Infer" title="Semantic">Infer</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></li><li class="src short"><a href="#v:boolBin">boolBin</a> :: <a href="Syntax.html#t:BinOperator" title="Syntax">BinOperator</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Infer" title="Semantic">Infer</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></li><li class="src short"><a href="#v:compBin">compBin</a> :: <a href="Syntax.html#t:BinOperator" title="Syntax">BinOperator</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Infer" title="Semantic">Infer</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></li><li class="src short"><a href="#v:ensureBool">ensureBool</a> :: <a href="Syntax.html#t:Expr" title="Syntax">Expr</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Infer" title="Semantic">Infer</a> ()</li><li class="src short"><a href="#v:freshTypeVar">freshTypeVar</a> :: <a href="Semantic.html#t:Infer" title="Semantic">Infer</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></li><li class="src short"><a href="#v:isPoly">isPoly</a> :: <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; Bool</li><li class="src short"><a href="#v:checkAll">checkAll</a> :: <a href="Syntax.html#t:Program" title="Syntax">Program</a> -&gt; [<a href="Semantic.html#t:Error" title="Semantic">Error</a>]</li><li class="src short"><a href="#v:assignSuperNames">assignSuperNames</a> :: <a href="Syntax.html#t:Program" title="Syntax">Program</a> -&gt; <a href="Syntax.html#t:Program" title="Syntax">Program</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:desugarDecl" class="def">desugarDecl</a> :: <a href="Syntax.html#t:Decl" title="Syntax">Decl</a> -&gt; <a href="Syntax.html#t:Decl" title="Syntax">Decl</a> <a href="src/Semantic.html#desugarDecl" class="link">Source</a> <a href="#v:desugarDecl" class="selflink">#</a></p><div class="doc"><p>Desugar a single declaration.</p><h3>Description</h3><p>Collapses a point-free form <code>f = \ps -&gt; e</code> into an explicit clause
 <code>f ps = e</code>. Other declarations are returned unchanged.</p></div></div><div class="top"><p class="src"><a id="v:desugarProgram" class="def">desugarProgram</a> :: <a href="Syntax.html#t:Program" title="Syntax">Program</a> -&gt; <a href="Syntax.html#t:Program" title="Syntax">Program</a> <a href="src/Semantic.html#desugarProgram" class="link">Source</a> <a href="#v:desugarProgram" class="selflink">#</a></p><div class="doc"><p>Desugar the entire program via <code><a href="Semantic.html#v:desugarDecl" title="Semantic">desugarDecl</a></code>.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:SemanticError" class="def">SemanticError</a> <a href="src/Semantic.html#SemanticError" class="link">Source</a> <a href="#t:SemanticError" class="selflink">#</a></p><div class="doc"><p>Semantic (non-typing) error kinds.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:UndefinedVar" class="def">UndefinedVar</a> <a href="Syntax.html#t:Ident" title="Syntax">Ident</a></td><td class="doc"><p>Variable not bound in scope/signature.</p></td></tr><tr><td class="src"><a id="v:ArityMismatch" class="def">ArityMismatch</a> <a href="Syntax.html#t:Ident" title="Syntax">Ident</a> Int Int</td><td class="doc"><p>Function name, expected arity, actual arity.</p></td></tr><tr><td class="src"><a id="v:DuplicateFunc" class="def">DuplicateFunc</a> <a href="Syntax.html#t:Ident" title="Syntax">Ident</a></td><td class="doc"><p>Duplicated top-level function.</p></td></tr><tr><td class="src"><a id="v:DuplicateParam" class="def">DuplicateParam</a> <a href="Syntax.html#t:Ident" title="Syntax">Ident</a></td><td class="doc"><p>Duplicated parameter in a binder.</p></td></tr><tr><td class="src"><a id="v:DuplicatePatternVar" class="def">DuplicatePatternVar</a> <a href="Syntax.html#t:Ident" title="Syntax">Ident</a></td><td class="doc"><p>Duplicated variable inside one pattern.</p></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:SemanticError">Instances</h4><details id="i:SemanticError" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SemanticError:Show:1"></span> Show <a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a></span> <a href="src/Semantic.html#line-61" class="link">Source</a> <a href="#t:SemanticError" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:SemanticError:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Semantic.html">Semantic</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: Int -&gt; <a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a> -&gt; ShowS</p><p class="src"><a href="#v:show">show</a> :: <a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a> -&gt; String</p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a>] -&gt; ShowS</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SemanticError:Eq:2"></span> Eq <a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a></span> <a href="src/Semantic.html#line-61" class="link">Source</a> <a href="#t:SemanticError" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:SemanticError:Eq:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Semantic.html">Semantic</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a> -&gt; <a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a> -&gt; Bool</p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a> -&gt; <a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a> -&gt; Bool</p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:TypeError" class="def">TypeError</a> <a href="src/Semantic.html#TypeError" class="link">Source</a> <a href="#t:TypeError" class="selflink">#</a></p><div class="doc"><p>Type errors produced by inference.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Mismatch" class="def">Mismatch</a> <a href="Syntax.html#t:Expr" title="Syntax">Expr</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></td><td class="doc"><p>Expression, expected type, actual type.</p></td></tr><tr><td class="src"><a id="v:CondNotBool" class="def">CondNotBool</a> <a href="Syntax.html#t:Expr" title="Syntax">Expr</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></td><td class="doc"><p>Non-boolean condition in <code>if</code>.</p></td></tr><tr><td class="src"><a id="v:BranchesTypeDiffer" class="def">BranchesTypeDiffer</a> <a href="Syntax.html#t:Expr" title="Syntax">Expr</a> <a href="Syntax.html#t:Expr" title="Syntax">Expr</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:BinOpTypeErr" class="def">BinOpTypeErr</a> <a href="Syntax.html#t:BinOperator" title="Syntax">BinOperator</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></td><td class="doc"><p>Ill-typed binary operator application.</p></td></tr><tr><td class="src"><a id="v:UnOpTypeErr" class="def">UnOpTypeErr</a> <a href="Syntax.html#t:UnOperator" title="Syntax">UnOperator</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></td><td class="doc"><p>Ill-typed unary operator application.</p></td></tr><tr><td class="src"><a id="v:UnknownVar" class="def">UnknownVar</a> <a href="Syntax.html#t:Ident" title="Syntax">Ident</a></td><td class="doc"><p>Variable unknown to the typing envs.</p></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:TypeError">Instances</h4><details id="i:TypeError" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:TypeError:Show:1"></span> Show <a href="Semantic.html#t:TypeError" title="Semantic">TypeError</a></span> <a href="src/Semantic.html#line-71" class="link">Source</a> <a href="#t:TypeError" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:TypeError:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Semantic.html">Semantic</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: Int -&gt; <a href="Semantic.html#t:TypeError" title="Semantic">TypeError</a> -&gt; ShowS</p><p class="src"><a href="#v:show">show</a> :: <a href="Semantic.html#t:TypeError" title="Semantic">TypeError</a> -&gt; String</p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Semantic.html#t:TypeError" title="Semantic">TypeError</a>] -&gt; ShowS</p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Error" class="def">Error</a> <a href="src/Semantic.html#Error" class="link">Source</a> <a href="#t:Error" class="selflink">#</a></p><div class="doc"><p>Unified error wrapper (semantic or typing).</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:SemErr" class="def">SemErr</a> <a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:TypErr" class="def">TypErr</a> <a href="Semantic.html#t:TypeError" title="Semantic">TypeError</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:Error">Instances</h4><details id="i:Error" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Error:Show:1"></span> Show <a href="Semantic.html#t:Error" title="Semantic">Error</a></span> <a href="src/Semantic.html#line-77" class="link">Source</a> <a href="#t:Error" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Error:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Semantic.html">Semantic</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: Int -&gt; <a href="Semantic.html#t:Error" title="Semantic">Error</a> -&gt; ShowS</p><p class="src"><a href="#v:show">show</a> :: <a href="Semantic.html#t:Error" title="Semantic">Error</a> -&gt; String</p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Semantic.html#t:Error" title="Semantic">Error</a>] -&gt; ShowS</p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:Sig" class="def">Sig</a> = Map <a href="Syntax.html#t:Ident" title="Syntax">Ident</a> Int <a href="src/Semantic.html#Sig" class="link">Source</a> <a href="#t:Sig" class="selflink">#</a></p><div class="doc"><p>Top-level signature of functions: name &#8614; arity.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:Env" class="def">Env</a> = Set <a href="Syntax.html#t:Ident" title="Syntax">Ident</a> <a href="src/Semantic.html#Env" class="link">Source</a> <a href="#t:Env" class="selflink">#</a></p><div class="doc"><p>Variable environment for semantic checking.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Type" class="def">Type</a> <a href="src/Semantic.html#Type" class="link">Source</a> <a href="#t:Type" class="selflink">#</a></p><div class="doc"><p>Core type algebra for inference.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:TInt" class="def">TInt</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:TFloat" class="def">TFloat</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:TBool" class="def">TBool</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:TChar" class="def">TChar</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:TString" class="def">TString</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:TList" class="def">TList</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:TTuple" class="def">TTuple</a> [<a href="Semantic.html#t:Type" title="Semantic">Type</a>]</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:TVar" class="def">TVar</a> String</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:TFun" class="def">TFun</a> [<a href="Semantic.html#t:Type" title="Semantic">Type</a>] <a href="Semantic.html#t:Type" title="Semantic">Type</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:Type">Instances</h4><details id="i:Type" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Type:Show:1"></span> Show <a href="Semantic.html#t:Type" title="Semantic">Type</a></span> <a href="src/Semantic.html#line-92" class="link">Source</a> <a href="#t:Type" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Type:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Semantic.html">Semantic</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: Int -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; ShowS</p><p class="src"><a href="#v:show">show</a> :: <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; String</p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Semantic.html#t:Type" title="Semantic">Type</a>] -&gt; ShowS</p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Type:Eq:2"></span> Eq <a href="Semantic.html#t:Type" title="Semantic">Type</a></span> <a href="src/Semantic.html#line-92" class="link">Source</a> <a href="#t:Type" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Type:Eq:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Semantic.html">Semantic</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; Bool</p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; Bool</p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:TypeEnv" class="def">TypeEnv</a> = Map <a href="Syntax.html#t:Ident" title="Syntax">Ident</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a> <a href="src/Semantic.html#TypeEnv" class="link">Source</a> <a href="#t:TypeEnv" class="selflink">#</a></p><div class="doc"><p>Environment of term variables: var &#8614; type.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:FuncEnv" class="def">FuncEnv</a> = Map <a href="Syntax.html#t:Ident" title="Syntax">Ident</a> ([<a href="Semantic.html#t:Type" title="Semantic">Type</a>], <a href="Semantic.html#t:Type" title="Semantic">Type</a>) <a href="src/Semantic.html#FuncEnv" class="link">Source</a> <a href="#t:FuncEnv" class="selflink">#</a></p><div class="doc"><p>Environment of functions: name &#8614; (arg types, return type).</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:InferState" class="def">InferState</a> <a href="src/Semantic.html#InferState" class="link">Source</a> <a href="#t:InferState" class="selflink">#</a></p><div class="doc"><p>State used to generate fresh type variables.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:InferState" class="def">InferState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:count" class="def">count</a> :: Int</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:Infer" class="def">Infer</a> a = ExceptT <a href="Semantic.html#t:TypeError" title="Semantic">TypeError</a> (State <a href="Semantic.html#t:InferState" title="Semantic">InferState</a>) a <a href="src/Semantic.html#Infer" class="link">Source</a> <a href="#t:Infer" class="selflink">#</a></p><div class="doc"><p>Inference monad: exceptions for <code><a href="Semantic.html#t:TypeError" title="Semantic">TypeError</a></code> + fresh var state.</p></div></div><div class="top"><p class="src"><a id="v:buildSig" class="def">buildSig</a> :: [<a href="Syntax.html#t:Decl" title="Syntax">Decl</a>] -&gt; <a href="Semantic.html#t:Sig" title="Semantic">Sig</a> <a href="src/Semantic.html#buildSig" class="link">Source</a> <a href="#v:buildSig" class="selflink">#</a></p><div class="doc"><p>Build a top-level signature (arity) from a list of declarations.</p><p>If a function appears multiple times, the first arity is kept.</p></div></div><div class="top"><p class="src"><a id="v:buildFuncEnv" class="def">buildFuncEnv</a> :: [<a href="Syntax.html#t:Decl" title="Syntax">Decl</a>] -&gt; <a href="Semantic.html#t:FuncEnv" title="Semantic">FuncEnv</a> <a href="src/Semantic.html#buildFuncEnv" class="link">Source</a> <a href="#v:buildFuncEnv" class="selflink">#</a></p><div class="doc"><p>Create a function environment assigning fresh type variables to
 each function's arguments and a unique return type variable <code>r_f</code>.</p></div></div><div class="top"><p class="src"><a id="v:semanticCheck" class="def">semanticCheck</a> :: <a href="Syntax.html#t:Program" title="Syntax">Program</a> -&gt; [<a href="Semantic.html#t:Error" title="Semantic">Error</a>] <a href="src/Semantic.html#semanticCheck" class="link">Source</a> <a href="#v:semanticCheck" class="selflink">#</a></p><div class="doc"><p>Run semantic checks (no typing) over the program and collect all errors.</p><p>Checks:
 - Duplicate top-level functions
 - Undefined vars, arity, duplicate params/pattern vars</p></div></div><div class="top"><p class="src"><a id="v:checkDecl" class="def">checkDecl</a> :: <a href="Semantic.html#t:Sig" title="Semantic">Sig</a> -&gt; <a href="Syntax.html#t:Decl" title="Syntax">Decl</a> -&gt; [<a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a>] <a href="src/Semantic.html#checkDecl" class="link">Source</a> <a href="#v:checkDecl" class="selflink">#</a></p><div class="doc"><p>Check a single function declaration.</p></div></div><div class="top"><p class="src"><a id="v:checkExpr" class="def">checkExpr</a> :: <a href="Semantic.html#t:Sig" title="Semantic">Sig</a> -&gt; <a href="Semantic.html#t:Env" title="Semantic">Env</a> -&gt; <a href="Syntax.html#t:Expr" title="Syntax">Expr</a> -&gt; [<a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a>] <a href="src/Semantic.html#checkExpr" class="link">Source</a> <a href="#v:checkExpr" class="selflink">#</a></p><div class="doc"><p>Check an expression for semantic issues under a signature and env.</p></div></div><div class="top"><p class="src"><a id="v:checkAlt" class="def">checkAlt</a> :: <a href="Semantic.html#t:Sig" title="Semantic">Sig</a> -&gt; <a href="Semantic.html#t:Env" title="Semantic">Env</a> -&gt; (<a href="Syntax.html#t:Pattern" title="Syntax">Pattern</a>, <a href="Syntax.html#t:Expr" title="Syntax">Expr</a>) -&gt; [<a href="Semantic.html#t:SemanticError" title="Semantic">SemanticError</a>] <a href="src/Semantic.html#checkAlt" class="link">Source</a> <a href="#v:checkAlt" class="selflink">#</a></p><div class="doc"><p>Check a single case alternative (pattern + branch body).</p></div></div><div class="top"><p class="src"><a id="v:flattenApp" class="def">flattenApp</a> :: <a href="Syntax.html#t:Expr" title="Syntax">Expr</a> -&gt; (<a href="Syntax.html#t:Expr" title="Syntax">Expr</a>, [<a href="Syntax.html#t:Expr" title="Syntax">Expr</a>]) <a href="src/Semantic.html#flattenApp" class="link">Source</a> <a href="#v:flattenApp" class="selflink">#</a></p><div class="doc"><p>Flatten nested applications into <code>(function, [args])</code>, left to right.</p></div></div><div class="top"><p class="src"><a id="v:patVars" class="def">patVars</a> :: <a href="Syntax.html#t:Pattern" title="Syntax">Pattern</a> -&gt; [<a href="Syntax.html#t:Ident" title="Syntax">Ident</a>] <a href="src/Semantic.html#patVars" class="link">Source</a> <a href="#v:patVars" class="selflink">#</a></p><div class="doc"><p>Collect variable names bound by a pattern (preorder, left-to-right).</p></div></div><div class="top"><p class="src"><a id="v:checkProgram" class="def">checkProgram</a> :: <a href="Syntax.html#t:Program" title="Syntax">Program</a> -&gt; [<a href="Semantic.html#t:Error" title="Semantic">Error</a>] <a href="src/Semantic.html#checkProgram" class="link">Source</a> <a href="#v:checkProgram" class="selflink">#</a></p><div class="doc"><p>Run the typing pass per declaration (after desugaring) and collect errors.</p></div></div><div class="top"><p class="src"><a id="v:unifyReturn" class="def">unifyReturn</a> :: <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Infer" title="Semantic">Infer</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a> <a href="src/Semantic.html#unifyReturn" class="link">Source</a> <a href="#v:unifyReturn" class="selflink">#</a></p><div class="doc"><p>Unify two (return) types, preferring concrete types when possible.</p></div></div><div class="top"><p class="src"><a id="v:isTVar" class="def">isTVar</a> :: <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; Bool <a href="src/Semantic.html#isTVar" class="link">Source</a> <a href="#v:isTVar" class="selflink">#</a></p><div class="doc"><p>Test whether a type is a type variable.</p></div></div><div class="top"><p class="src"><a id="v:inferExpr" class="def">inferExpr</a> :: <a href="Semantic.html#t:FuncEnv" title="Semantic">FuncEnv</a> -&gt; <a href="Semantic.html#t:TypeEnv" title="Semantic">TypeEnv</a> -&gt; <a href="Syntax.html#t:Expr" title="Syntax">Expr</a> -&gt; <a href="Semantic.html#t:Infer" title="Semantic">Infer</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a> <a href="src/Semantic.html#inferExpr" class="link">Source</a> <a href="#v:inferExpr" class="selflink">#</a></p><div class="doc"><p>Infer the type of an expression under function and term environments.</p></div></div><div class="top"><p class="src"><a id="v:match" class="def">match</a> :: <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; Bool <a href="src/Semantic.html#match" class="link">Source</a> <a href="#v:match" class="selflink">#</a></p><div class="doc"><p>Type compatibility treating <code><a href="Semantic.html#v:TVar" title="Semantic">TVar</a></code> as wildcard.</p></div></div><div class="top"><p class="src"><a id="v:resolve" class="def">resolve</a> :: <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> <a href="src/Semantic.html#resolve" class="link">Source</a> <a href="#v:resolve" class="selflink">#</a></p><div class="doc"><p>Resolve two compatible types, preferring non-<code><a href="Semantic.html#v:TVar" title="Semantic">TVar</a></code> when available.</p></div></div><div class="top"><p class="src"><a id="v:inferPattern" class="def">inferPattern</a> :: <a href="Syntax.html#t:Pattern" title="Syntax">Pattern</a> -&gt; <a href="Semantic.html#t:Infer" title="Semantic">Infer</a> ([(<a href="Syntax.html#t:Ident" title="Syntax">Ident</a>, <a href="Semantic.html#t:Type" title="Semantic">Type</a>)], <a href="Semantic.html#t:Type" title="Semantic">Type</a>) <a href="src/Semantic.html#inferPattern" class="link">Source</a> <a href="#v:inferPattern" class="selflink">#</a></p><div class="doc"><p>Infer a pattern, returning (bound variables with types, pattern type).</p></div></div><div class="top"><p class="src"><a id="v:literalType" class="def">literalType</a> :: <a href="Syntax.html#t:Literal" title="Syntax">Literal</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> <a href="src/Semantic.html#literalType" class="link">Source</a> <a href="#v:literalType" class="selflink">#</a></p><div class="doc"><p>Type of a literal constant.</p></div></div><div class="top"><p class="src"><a id="v:numBin" class="def">numBin</a> :: <a href="Syntax.html#t:BinOperator" title="Syntax">BinOperator</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Infer" title="Semantic">Infer</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a> <a href="src/Semantic.html#numBin" class="link">Source</a> <a href="#v:numBin" class="selflink">#</a></p><div class="doc"><p>Typing rules for numeric <em> boolean </em> comparison binary operators.</p></div></div><div class="top"><p class="src"><a id="v:boolBin" class="def">boolBin</a> :: <a href="Syntax.html#t:BinOperator" title="Syntax">BinOperator</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Infer" title="Semantic">Infer</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a> <a href="src/Semantic.html#boolBin" class="link">Source</a> <a href="#v:boolBin" class="selflink">#</a></p><div class="doc"><p>Typing rules for numeric <em> boolean </em> comparison binary operators.</p></div></div><div class="top"><p class="src"><a id="v:compBin" class="def">compBin</a> :: <a href="Syntax.html#t:BinOperator" title="Syntax">BinOperator</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Infer" title="Semantic">Infer</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a> <a href="src/Semantic.html#compBin" class="link">Source</a> <a href="#v:compBin" class="selflink">#</a></p><div class="doc"><p>Typing rules for numeric <em> boolean </em> comparison binary operators.</p></div></div><div class="top"><p class="src"><a id="v:ensureBool" class="def">ensureBool</a> :: <a href="Syntax.html#t:Expr" title="Syntax">Expr</a> -&gt; <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; <a href="Semantic.html#t:Infer" title="Semantic">Infer</a> () <a href="src/Semantic.html#ensureBool" class="link">Source</a> <a href="#v:ensureBool" class="selflink">#</a></p><div class="doc"><p>Ensure a condition type is boolean (or polymorphic to be resolved later).</p></div></div><div class="top"><p class="src"><a id="v:freshTypeVar" class="def">freshTypeVar</a> :: <a href="Semantic.html#t:Infer" title="Semantic">Infer</a> <a href="Semantic.html#t:Type" title="Semantic">Type</a> <a href="src/Semantic.html#freshTypeVar" class="link">Source</a> <a href="#v:freshTypeVar" class="selflink">#</a></p><div class="doc"><p>Generate a fresh type variable <code>t1, t2, ...</code>.</p></div></div><div class="top"><p class="src"><a id="v:isPoly" class="def">isPoly</a> :: <a href="Semantic.html#t:Type" title="Semantic">Type</a> -&gt; Bool <a href="src/Semantic.html#isPoly" class="link">Source</a> <a href="#v:isPoly" class="selflink">#</a></p><div class="doc"><p>Predicate: is this type a polymorphic variable?</p></div></div><div class="top"><p class="src"><a id="v:checkAll" class="def">checkAll</a> :: <a href="Syntax.html#t:Program" title="Syntax">Program</a> -&gt; [<a href="Semantic.html#t:Error" title="Semantic">Error</a>] <a href="src/Semantic.html#checkAll" class="link">Source</a> <a href="#v:checkAll" class="selflink">#</a></p><div class="doc"><p>Run both passes and return all collected errors.</p></div></div><div class="top"><p class="src"><a id="v:assignSuperNames" class="def">assignSuperNames</a> :: <a href="Syntax.html#t:Program" title="Syntax">Program</a> -&gt; <a href="Syntax.html#t:Program" title="Syntax">Program</a> <a href="src/Semantic.html#assignSuperNames" class="link">Source</a> <a href="#v:assignSuperNames" class="selflink">#</a></p><div class="doc"><p>Assign fresh symbolic names <code>s1, s2, ...</code> to <code><a href="Syntax.html#v:Super" title="Syntax">Super</a></code> nodes across the program.</p><p>This transform preserves the kind, input/output variables and body content.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>