<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="annot"><span class="hs-comment">{-|
Module      : Synthesis.Builder
Description : Lowers the core AST to a dataflow graph (DFG) of 'DNode's, wiring ports and managing environments/aliases.
Copyright   :
License     :
Maintainer  : ricardofilhoschool@gmail.com
Stability   : experimental
Portability : portable

This module builds a 'DFG' from a 'Syntax.Program'. It:

* Tracks lexical environments and free variables during synthesis.
* Emits nodes/edges, including fan-out via an alias mechanism.
* Handles applications (including n-ary flattening), conditionals, lists/tuples.
* Creates call/return groups for function calls and lambdas.
* Assigns names to @Super@ blocks via 'Semantic.assignSuperNames' before building.
-}</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Synthesis.Builder</span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#DFG"><span class="hs-identifier">DFG</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#buildProgram"><span class="hs-identifier">buildProgram</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lookup</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forM_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipWithM_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">StateT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">get</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">put</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runStateT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">gets</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">modify</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span>              </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span>              </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Semantic.html"><span class="hs-identifier">Semantic</span></a></span><span>              </span><span class="hs-special">(</span><span class="annot"><a href="Semantic.html#assignSuperNames"><span class="hs-identifier">assignSuperNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Syntax.html"><span class="hs-identifier">Syntax</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Types.html"><span class="hs-identifier">Types</span></a></span><span>                  </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#DGraph"><span class="hs-identifier">DGraph</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#Edge"><span class="hs-identifier">Edge</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#NodeId"><span class="hs-identifier">NodeId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#emptyGraph"><span class="hs-identifier">emptyGraph</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#addNode"><span class="hs-identifier">addNode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#addEdge"><span class="hs-identifier">addEdge</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Port.html"><span class="hs-identifier">Port</span></a></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier">Port</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Port.html#--%3E"><span class="hs-operator">(--&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Unique.html"><span class="hs-identifier">Unique</span></a></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="Unique.html#Unique"><span class="hs-identifier">Unique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unique.html#evalUnique"><span class="hs-identifier">evalUnique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unique.html#freshId"><span class="hs-identifier">freshId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Node.html"><span class="hs-identifier">Node</span></a></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="Node.html#DNode"><span class="hs-identifier">DNode</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-comment">-- Grafo final</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="annot"><span class="hs-comment">-- | Final dataflow graph specialized to 'DNode'.</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">type</span><span> </span><span id="DFG"><span class="annot"><a href="Synthesis.Builder.html#DFG"><span class="hs-identifier hs-var">DFG</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Types.html#DGraph"><span class="hs-identifier hs-type">DGraph</span></a></span><span> </span><span class="annot"><a href="Node.html#DNode"><span class="hs-identifier hs-type">DNode</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-comment">-- Ambiente</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="annot"><span class="hs-comment">-- | Builder-time binding: either a realized 'Port' or a lambda to be built.</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">data</span><span> </span><span id="Binding"><span class="annot"><a href="Synthesis.Builder.html#Binding"><span class="hs-identifier hs-var">Binding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BPort"><span class="annot"><a href="Synthesis.Builder.html#BPort"><span class="hs-identifier hs-var">BPort</span></a></span></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="BLam"><span class="annot"><a href="Synthesis.Builder.html#BLam"><span class="hs-identifier hs-var">BLam</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="Syntax.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="annot"><span class="hs-comment">-- | A single-scope environment mapping identifiers to 'Binding'.</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">type</span><span> </span><span id="Env"><span class="annot"><a href="Synthesis.Builder.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="annot"><span class="hs-comment">-- | Aliases for a producer output identified by ('NodeId', output name).</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">type</span><span> </span><span id="AliasMap"><span class="annot"><a href="Synthesis.Builder.html#AliasMap"><span class="hs-identifier hs-var">AliasMap</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="annot"><span class="hs-comment">-- | Stack of currently active (being-built) functions.</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">type</span><span> </span><span id="ActiveStack"><span class="annot"><a href="Synthesis.Builder.html#ActiveStack"><span class="hs-identifier hs-var">ActiveStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="annot"><span class="hs-comment">-- | Global state for the builder pass.</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">data</span><span> </span><span id="BuildS"><span class="annot"><a href="Synthesis.Builder.html#BuildS"><span class="hs-identifier hs-var">BuildS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BuildS"><span class="annot"><a href="Synthesis.Builder.html#BuildS"><span class="hs-identifier hs-var">BuildS</span></a></span></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="bsGraph"><span class="annot"><span class="annottext">BuildS -&gt; DFG
</span><a href="Synthesis.Builder.html#bsGraph"><span class="hs-identifier hs-var hs-var">bsGraph</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Synthesis.Builder.html#DFG"><span class="hs-identifier hs-type">DFG</span></a></span><span>           </span><span class="annot"><span class="hs-comment">-- ^ Accumulated graph.</span></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="bsEnv"><span class="annot"><span class="annottext">BuildS -&gt; [Env]
</span><a href="Synthesis.Builder.html#bsEnv"><span class="hs-identifier hs-var hs-var">bsEnv</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="Synthesis.Builder.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span class="hs-special">]</span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Environment stack (innermost at head).</span></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="bsAliases"><span class="annot"><span class="annottext">BuildS -&gt; AliasMap
</span><a href="Synthesis.Builder.html#bsAliases"><span class="hs-identifier hs-var hs-var">bsAliases</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Synthesis.Builder.html#AliasMap"><span class="hs-identifier hs-type">AliasMap</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Extra outputs that mirror a producer port.</span></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="bsActive"><span class="annot"><span class="annottext">BuildS -&gt; ActiveStack
</span><a href="Synthesis.Builder.html#bsActive"><span class="hs-identifier hs-var hs-var">bsActive</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Synthesis.Builder.html#ActiveStack"><span class="hs-identifier hs-type">ActiveStack</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Functions under construction (re-entrancy guard).</span></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="bsFloatFuns"><span class="annot"><span class="annottext">BuildS -&gt; Set Ident
</span><a href="Synthesis.Builder.html#bsFloatFuns"><span class="hs-identifier hs-var hs-var">bsFloatFuns</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Functions observed in float contexts.</span></span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="annot"><span class="hs-comment">-- | Initial empty builder state.</span></span><span>
</span><span id="line-70"></span><span class="annot"><a href="Synthesis.Builder.html#emptyS"><span class="hs-identifier hs-type">emptyS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#BuildS"><span class="hs-identifier hs-type">BuildS</span></a></span><span>
</span><span id="line-71"></span><span id="emptyS"><span class="annot"><span class="annottext">emptyS :: BuildS
</span><a href="Synthesis.Builder.html#emptyS"><span class="hs-identifier hs-var hs-var">emptyS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DFG -&gt; [Env] -&gt; AliasMap -&gt; ActiveStack -&gt; Set Ident -&gt; BuildS
</span><a href="Synthesis.Builder.html#BuildS"><span class="hs-identifier hs-var">BuildS</span></a></span><span> </span><span class="annot"><span class="annottext">DFG
forall n. DGraph n
</span><a href="Types.html#emptyGraph"><span class="hs-identifier hs-var">emptyGraph</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Env
forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">AliasMap
forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Set Ident
forall a. Set a
</span><span class="hs-identifier hs-var">S.empty</span></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><span class="hs-comment">-- | Builder monad with unique-id generation.</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">newtype</span><span> </span><span id="Build"><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span></span><span> </span><span id="local-6989586621679181034"><span class="annot"><a href="#local-6989586621679181034"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Build"><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unBuild"><span class="annot"><span class="annottext">forall a. Build a -&gt; StateT BuildS Unique a
</span><a href="Synthesis.Builder.html#unBuild"><span class="hs-identifier hs-var hs-var">unBuild</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="Synthesis.Builder.html#BuildS"><span class="hs-identifier hs-type">BuildS</span></a></span><span> </span><span class="annot"><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181034"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679181524"><span id="local-6989586621679181528"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; Build a -&gt; Build b)
-&gt; (forall a b. a -&gt; Build b -&gt; Build a) -&gt; Functor Build
forall a b. a -&gt; Build b -&gt; Build a
forall a b. (a -&gt; b) -&gt; Build a -&gt; Build b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; Build a -&gt; Build b
fmap :: forall a b. (a -&gt; b) -&gt; Build a -&gt; Build b
$c&lt;$ :: forall a b. a -&gt; Build b -&gt; Build a
&lt;$ :: forall a b. a -&gt; Build b -&gt; Build a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679181535"><span id="local-6989586621679181539"><span id="local-6989586621679181543"><span id="local-6989586621679181547"><span id="local-6989586621679181551"><span class="annot"><span class="annottext">Functor Build
Functor Build =&gt;
(forall a. a -&gt; Build a)
-&gt; (forall a b. Build (a -&gt; b) -&gt; Build a -&gt; Build b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; Build a -&gt; Build b -&gt; Build c)
-&gt; (forall a b. Build a -&gt; Build b -&gt; Build b)
-&gt; (forall a b. Build a -&gt; Build b -&gt; Build a)
-&gt; Applicative Build
forall a. a -&gt; Build a
forall a b. Build a -&gt; Build b -&gt; Build a
forall a b. Build a -&gt; Build b -&gt; Build b
forall a b. Build (a -&gt; b) -&gt; Build a -&gt; Build b
forall a b c. (a -&gt; b -&gt; c) -&gt; Build a -&gt; Build b -&gt; Build c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall a. a -&gt; Build a
pure :: forall a. a -&gt; Build a
$c&lt;*&gt; :: forall a b. Build (a -&gt; b) -&gt; Build a -&gt; Build b
&lt;*&gt; :: forall a b. Build (a -&gt; b) -&gt; Build a -&gt; Build b
$cliftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; Build a -&gt; Build b -&gt; Build c
liftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; Build a -&gt; Build b -&gt; Build c
$c*&gt; :: forall a b. Build a -&gt; Build b -&gt; Build b
*&gt; :: forall a b. Build a -&gt; Build b -&gt; Build b
$c&lt;* :: forall a b. Build a -&gt; Build b -&gt; Build a
&lt;* :: forall a b. Build a -&gt; Build b -&gt; Build a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679181558"><span id="local-6989586621679181562"><span id="local-6989586621679181566"><span class="annot"><span class="annottext">Applicative Build
Applicative Build =&gt;
(forall a b. Build a -&gt; (a -&gt; Build b) -&gt; Build b)
-&gt; (forall a b. Build a -&gt; Build b -&gt; Build b)
-&gt; (forall a. a -&gt; Build a)
-&gt; Monad Build
forall a. a -&gt; Build a
forall a b. Build a -&gt; Build b -&gt; Build b
forall a b. Build a -&gt; (a -&gt; Build b) -&gt; Build b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall a b. Build a -&gt; (a -&gt; Build b) -&gt; Build b
&gt;&gt;= :: forall a b. Build a -&gt; (a -&gt; Build b) -&gt; Build b
$c&gt;&gt; :: forall a b. Build a -&gt; Build b -&gt; Build b
&gt;&gt; :: forall a b. Build a -&gt; Build b -&gt; Build b
$creturn :: forall a. a -&gt; Build a
return :: forall a. a -&gt; Build a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="annot"><span class="hs-comment">-- | Execute a 'Build' computation, returning the result and final state.</span></span><span>
</span><span id="line-78"></span><span id="local-6989586621679181079"><span class="annot"><a href="Synthesis.Builder.html#runBuild"><span class="hs-identifier hs-type">runBuild</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181079"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679181079"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#BuildS"><span class="hs-identifier hs-type">BuildS</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-79"></span><span id="runBuild"><span class="annot"><span class="annottext">runBuild :: forall a. Build a -&gt; (a, BuildS)
</span><a href="Synthesis.Builder.html#runBuild"><span class="hs-identifier hs-var hs-var">runBuild</span></a></span></span><span> </span><span id="local-6989586621679181571"><span class="annot"><span class="annottext">Build a
</span><a href="#local-6989586621679181571"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique (a, BuildS) -&gt; (a, BuildS)
forall a. Unique a -&gt; a
</span><a href="Unique.html#evalUnique"><span class="hs-identifier hs-var">evalUnique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateT BuildS Unique a -&gt; BuildS -&gt; Unique (a, BuildS)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var">runStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Build a -&gt; StateT BuildS Unique a
forall a. Build a -&gt; StateT BuildS Unique a
</span><a href="Synthesis.Builder.html#unBuild"><span class="hs-identifier hs-var">unBuild</span></a></span><span> </span><span class="annot"><span class="annottext">Build a
</span><a href="#local-6989586621679181571"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="Synthesis.Builder.html#emptyS"><span class="hs-identifier hs-var">emptyS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">-- escopo ----------------------------------------------------------------</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="annot"><span class="hs-comment">-- | Push a fresh environment onto the stack.</span></span><span>
</span><span id="line-84"></span><span class="annot"><a href="Synthesis.Builder.html#pushEnv"><span class="hs-identifier hs-type">pushEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#popEnv"><span class="hs-identifier hs-type">popEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span id="pushEnv"><span class="annot"><span class="annottext">pushEnv :: Build ()
</span><a href="Synthesis.Builder.html#pushEnv"><span class="hs-identifier hs-var hs-var">pushEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique () -&gt; Build ()
forall a. StateT BuildS Unique a -&gt; Build a
</span><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BuildS Unique () -&gt; Build ())
-&gt; StateT BuildS Unique () -&gt; Build ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BuildS -&gt; BuildS) -&gt; StateT BuildS Unique ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679181574"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181574"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181574"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#bsEnv"><span class="hs-identifier hs-var">bsEnv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.empty</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="Synthesis.Builder.html#bsEnv"><span class="hs-identifier hs-var">bsEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181574"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="annot"><span class="hs-comment">-- | Pop the current environment (no-op on empty).</span></span><span>
</span><span id="line-88"></span><span id="popEnv"><span class="annot"><span class="annottext">popEnv :: Build ()
</span><a href="Synthesis.Builder.html#popEnv"><span class="hs-identifier hs-var hs-var">popEnv</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique () -&gt; Build ()
forall a. StateT BuildS Unique a -&gt; Build a
</span><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BuildS Unique () -&gt; Build ())
-&gt; StateT BuildS Unique () -&gt; Build ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BuildS -&gt; BuildS) -&gt; StateT BuildS Unique ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679181575"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181575"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BuildS -&gt; [Env]
</span><a href="Synthesis.Builder.html#bsEnv"><span class="hs-identifier hs-var">bsEnv</span></a></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181575"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181575"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679181576"><span class="annot"><span class="annottext">[Env]
</span><a href="#local-6989586621679181576"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181575"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#bsEnv"><span class="hs-identifier hs-var">bsEnv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181576"><span class="hs-identifier hs-type">rs</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="annot"><span class="hs-comment">-- | Run a computation with a temporary fresh environment.</span></span><span>
</span><span id="line-91"></span><span id="local-6989586621679181090"><span class="annot"><a href="Synthesis.Builder.html#withEnv"><span class="hs-identifier hs-type">withEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181090"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181090"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-92"></span><span id="withEnv"><span class="annot"><span class="annottext">withEnv :: forall a. Build a -&gt; Build a
</span><a href="Synthesis.Builder.html#withEnv"><span class="hs-identifier hs-var hs-var">withEnv</span></a></span></span><span> </span><span id="local-6989586621679181582"><span class="annot"><span class="annottext">Build a
</span><a href="#local-6989586621679181582"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Build ()
</span><a href="Synthesis.Builder.html#pushEnv"><span class="hs-identifier hs-var">pushEnv</span></a></span><span class="hs-special">;</span><span> </span><span id="local-6989586621679181583"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679181583"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Build a
</span><a href="#local-6989586621679181582"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Build ()
</span><a href="Synthesis.Builder.html#popEnv"><span class="hs-identifier hs-var">popEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Build a
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679181583"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="annot"><span class="hs-comment">-- | Insert a 'Binding' for an identifier into the current environment.</span></span><span>
</span><span id="line-95"></span><span class="annot"><a href="Synthesis.Builder.html#insertB"><span class="hs-identifier hs-type">insertB</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span id="insertB"><span class="annot"><span class="annottext">insertB :: Ident -&gt; Binding -&gt; Build ()
</span><a href="Synthesis.Builder.html#insertB"><span class="hs-identifier hs-var hs-var">insertB</span></a></span></span><span> </span><span id="local-6989586621679181585"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181585"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679181586"><span class="annot"><span class="annottext">Binding
</span><a href="#local-6989586621679181586"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique () -&gt; Build ()
forall a. StateT BuildS Unique a -&gt; Build a
</span><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BuildS Unique () -&gt; Build ())
-&gt; StateT BuildS Unique () -&gt; Build ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BuildS -&gt; BuildS) -&gt; StateT BuildS Unique ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((BuildS -&gt; BuildS) -&gt; StateT BuildS Unique ())
-&gt; (BuildS -&gt; BuildS) -&gt; StateT BuildS Unique ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679181587"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181587"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BuildS -&gt; [Env]
</span><a href="Synthesis.Builder.html#bsEnv"><span class="hs-identifier hs-var">bsEnv</span></a></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181587"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679181588"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679181588"><span class="hs-identifier hs-var">e</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679181589"><span class="annot"><span class="annottext">[Env]
</span><a href="#local-6989586621679181589"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181587"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#bsEnv"><span class="hs-identifier hs-var">bsEnv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621679181585"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181586"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181588"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621679181589"><span class="hs-identifier hs-type">rs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181587"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="annot"><span class="hs-comment">-- | Look up an identifier through the stacked environments (inner to outer).</span></span><span>
</span><span id="line-101"></span><span class="annot"><a href="Synthesis.Builder.html#lookupB"><span class="hs-identifier hs-type">lookupB</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span id="lookupB"><span class="annot"><span class="annottext">lookupB :: Ident -&gt; Build (Maybe Binding)
</span><a href="Synthesis.Builder.html#lookupB"><span class="hs-identifier hs-var hs-var">lookupB</span></a></span></span><span> </span><span id="local-6989586621679181592"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181592"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique (Maybe Binding) -&gt; Build (Maybe Binding)
forall a. StateT BuildS Unique a -&gt; Build a
</span><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BuildS Unique (Maybe Binding) -&gt; Build (Maybe Binding))
-&gt; StateT BuildS Unique (Maybe Binding) -&gt; Build (Maybe Binding)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BuildS -&gt; Maybe Binding) -&gt; StateT BuildS Unique (Maybe Binding)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((BuildS -&gt; Maybe Binding) -&gt; StateT BuildS Unique (Maybe Binding))
-&gt; (BuildS -&gt; Maybe Binding)
-&gt; StateT BuildS Unique (Maybe Binding)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679181593"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181593"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679181596"><span class="annot"><span class="annottext">go :: [Map Ident a] -&gt; Maybe a
</span><a href="#local-6989586621679181596"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-104"></span><span>      </span><span class="annot"><a href="#local-6989586621679181596"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679181597"><span class="annot"><span class="annottext">Map Ident a
</span><a href="#local-6989586621679181597"><span class="hs-identifier hs-var">e</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679181598"><span class="annot"><span class="annottext">[Map Ident a]
</span><a href="#local-6989586621679181598"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; (a -&gt; Maybe a) -&gt; Maybe a -&gt; Maybe a
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Map Ident a] -&gt; Maybe a
</span><a href="#local-6989586621679181596"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Map Ident a]
</span><a href="#local-6989586621679181598"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; Map Ident a -&gt; Maybe a
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181592"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map Ident a
</span><a href="#local-6989586621679181597"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Env] -&gt; Maybe Binding
forall {a}. [Map Ident a] -&gt; Maybe a
</span><a href="#local-6989586621679181596"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildS -&gt; [Env]
</span><a href="Synthesis.Builder.html#bsEnv"><span class="hs-identifier hs-var">bsEnv</span></a></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181593"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- marca&#231;&#227;o de fun&#231;&#227;o float ---------------------------------------------</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="annot"><span class="hs-comment">-- | Mark a function as having been used in a floating-point context.</span></span><span>
</span><span id="line-110"></span><span class="annot"><a href="Synthesis.Builder.html#markFloatFun"><span class="hs-identifier hs-type">markFloatFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span id="markFloatFun"><span class="annot"><span class="annottext">markFloatFun :: Ident -&gt; Build ()
</span><a href="Synthesis.Builder.html#markFloatFun"><span class="hs-identifier hs-var hs-var">markFloatFun</span></a></span></span><span> </span><span id="local-6989586621679181602"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181602"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique () -&gt; Build ()
forall a. StateT BuildS Unique a -&gt; Build a
</span><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BuildS Unique () -&gt; Build ())
-&gt; StateT BuildS Unique () -&gt; Build ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BuildS -&gt; BuildS) -&gt; StateT BuildS Unique ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679181603"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181603"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181603"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#bsFloatFuns"><span class="hs-identifier hs-var">bsFloatFuns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621679181602"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Synthesis.Builder.html#bsFloatFuns"><span class="hs-identifier hs-var">bsFloatFuns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181603"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="annot"><span class="hs-comment">-- | Check whether a function is marked as float.</span></span><span>
</span><span id="line-114"></span><span class="annot"><a href="Synthesis.Builder.html#isFloatFun"><span class="hs-identifier hs-type">isFloatFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-115"></span><span id="isFloatFun"><span class="annot"><span class="annottext">isFloatFun :: Ident -&gt; Build Bool
</span><a href="Synthesis.Builder.html#isFloatFun"><span class="hs-identifier hs-var hs-var">isFloatFun</span></a></span></span><span> </span><span id="local-6989586621679181606"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181606"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique Bool -&gt; Build Bool
forall a. StateT BuildS Unique a -&gt; Build a
</span><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BuildS Unique Bool -&gt; Build Bool)
-&gt; StateT BuildS Unique Bool -&gt; Build Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BuildS -&gt; Bool) -&gt; StateT BuildS Unique Bool
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679181607"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181607"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Set Ident -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">S.member</span></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181606"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildS -&gt; Set Ident
</span><a href="Synthesis.Builder.html#bsFloatFuns"><span class="hs-identifier hs-var">bsFloatFuns</span></a></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181607"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="annot"><span class="hs-comment">-- | True if the top of the active stack is a float-marked function.</span></span><span>
</span><span id="line-118"></span><span class="annot"><a href="Synthesis.Builder.html#isFloatActive"><span class="hs-identifier hs-type">isFloatActive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-119"></span><span id="isFloatActive"><span class="annot"><span class="annottext">isFloatActive :: Build Bool
</span><a href="Synthesis.Builder.html#isFloatActive"><span class="hs-identifier hs-var hs-var">isFloatActive</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique Bool -&gt; Build Bool
forall a. StateT BuildS Unique a -&gt; Build a
</span><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BuildS Unique Bool -&gt; Build Bool)
-&gt; StateT BuildS Unique Bool -&gt; Build Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BuildS -&gt; Bool) -&gt; StateT BuildS Unique Bool
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((BuildS -&gt; Bool) -&gt; StateT BuildS Unique Bool)
-&gt; (BuildS -&gt; Bool) -&gt; StateT BuildS Unique Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679181610"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181610"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BuildS -&gt; ActiveStack
</span><a href="Synthesis.Builder.html#bsActive"><span class="hs-identifier hs-var">bsActive</span></a></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181610"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679181611"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181611"><span class="hs-identifier hs-var">f</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">ActiveStack
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Set Ident -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">S.member</span></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181611"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildS -&gt; Set Ident
</span><a href="Synthesis.Builder.html#bsFloatFuns"><span class="hs-identifier hs-var">bsFloatFuns</span></a></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181610"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><span class="annottext">ActiveStack
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-comment">-- helper: est&#225; construindo 'f' agora?</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="annot"><span class="hs-comment">-- | Is a given function currently being built (in the active stack)?</span></span><span>
</span><span id="line-126"></span><span class="annot"><a href="Synthesis.Builder.html#isActiveFun"><span class="hs-identifier hs-type">isActiveFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-127"></span><span id="isActiveFun"><span class="annot"><span class="annottext">isActiveFun :: Ident -&gt; Build Bool
</span><a href="Synthesis.Builder.html#isActiveFun"><span class="hs-identifier hs-var hs-var">isActiveFun</span></a></span></span><span> </span><span id="local-6989586621679181613"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181613"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique Bool -&gt; Build Bool
forall a. StateT BuildS Unique a -&gt; Build a
</span><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BuildS Unique Bool -&gt; Build Bool)
-&gt; StateT BuildS Unique Bool -&gt; Build Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BuildS -&gt; Bool) -&gt; StateT BuildS Unique Bool
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679181614"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181614"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181613"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; ActiveStack -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">BuildS -&gt; ActiveStack
</span><a href="Synthesis.Builder.html#bsActive"><span class="hs-identifier hs-var">bsActive</span></a></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181614"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-comment">-- edges + aliases ------------------------------------------------------</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="annot"><span class="hs-comment">-- | Emit a raw 'Edge' into the graph.</span></span><span>
</span><span id="line-132"></span><span class="annot"><a href="Synthesis.Builder.html#emit"><span class="hs-identifier hs-type">emit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span id="emit"><span class="annot"><span class="annottext">emit :: Edge -&gt; Build ()
</span><a href="Synthesis.Builder.html#emit"><span class="hs-identifier hs-var hs-var">emit</span></a></span></span><span> </span><span id="local-6989586621679181617"><span class="annot"><span class="annottext">Edge
</span><a href="#local-6989586621679181617"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique () -&gt; Build ()
forall a. StateT BuildS Unique a -&gt; Build a
</span><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BuildS Unique () -&gt; Build ())
-&gt; StateT BuildS Unique () -&gt; Build ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BuildS -&gt; BuildS) -&gt; StateT BuildS Unique ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679181618"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181618"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181618"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#bsGraph"><span class="hs-identifier hs-var">bsGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Types.html#addEdge"><span class="hs-identifier hs-type">addEdge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181617"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Synthesis.Builder.html#bsGraph"><span class="hs-identifier hs-var">bsGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181618"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="annot"><span class="hs-comment">-- | Connect two 'Port's by emitting an edge.</span></span><span>
</span><span id="line-136"></span><span class="annot"><a href="Synthesis.Builder.html#connect"><span class="hs-identifier hs-type">connect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span id="connect"><span class="annot"><span class="annottext">connect :: Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connect"><span class="hs-identifier hs-var hs-var">connect</span></a></span></span><span> </span><span id="local-6989586621679181620"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181620"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679181621"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181621"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Edge -&gt; Build ()
</span><a href="Synthesis.Builder.html#emit"><span class="hs-identifier hs-var">emit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181620"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Edge
</span><a href="Port.html#--%3E"><span class="hs-operator hs-var">--&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181621"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="annot"><span class="hs-comment">-- | Register additional alias outputs for the same producer port.</span></span><span>
</span><span id="line-140"></span><span class="annot"><a href="Synthesis.Builder.html#registerAlias"><span class="hs-identifier hs-type">registerAlias</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span id="registerAlias"><span class="annot"><span class="annottext">registerAlias :: Port -&gt; [Port] -&gt; Build ()
</span><a href="Synthesis.Builder.html#registerAlias"><span class="hs-identifier hs-var hs-var">registerAlias</span></a></span></span><span> </span><span id="local-6989586621679181623"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181623"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621679181624"><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679181624"><span class="hs-identifier hs-var">extras</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique () -&gt; Build ()
forall a. StateT BuildS Unique a -&gt; Build a
</span><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BuildS Unique () -&gt; Build ())
-&gt; StateT BuildS Unique () -&gt; Build ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BuildS -&gt; BuildS) -&gt; StateT BuildS Unique ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((BuildS -&gt; BuildS) -&gt; StateT BuildS Unique ())
-&gt; (BuildS -&gt; BuildS) -&gt; StateT BuildS Unique ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679181625"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181625"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679181626"><span class="annot"><span class="annottext">k :: (Int, Ident)
</span><a href="#local-6989586621679181626"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port -&gt; Int
</span><a href="Port.html#pNode"><span class="hs-identifier hs-var">pNode</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181623"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Ident
</span><a href="Port.html#pName"><span class="hs-identifier hs-var">pName</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181623"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181625"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#bsAliases"><span class="hs-identifier hs-var">bsAliases</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.insertWith</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">(++)</span></span><span> </span><span class="annot"><a href="#local-6989586621679181626"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181624"><span class="hs-identifier hs-type">extras</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Synthesis.Builder.html#bsAliases"><span class="hs-identifier hs-var">bsAliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181625"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="annot"><span class="hs-comment">-- | Connect a destination to a source and all of its aliases.</span></span><span>
</span><span id="line-146"></span><span class="annot"><a href="Synthesis.Builder.html#connectPlus"><span class="hs-identifier hs-type">connectPlus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span id="connectPlus"><span class="annot"><span class="annottext">connectPlus :: Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connectPlus"><span class="hs-identifier hs-var hs-var">connectPlus</span></a></span></span><span> </span><span id="local-6989586621679181631"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181631"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621679181632"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181632"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique () -&gt; Build ()
forall a. StateT BuildS Unique a -&gt; Build a
</span><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BuildS Unique () -&gt; Build ())
-&gt; StateT BuildS Unique () -&gt; Build ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-148"></span><span>  </span><span id="local-6989586621679181633"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181633"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique BuildS
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679181634"><span class="annot"><span class="annottext">k :: (Int, Ident)
</span><a href="#local-6989586621679181634"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port -&gt; Int
</span><a href="Port.html#pNode"><span class="hs-identifier hs-var">pNode</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181631"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Ident
</span><a href="Port.html#pName"><span class="hs-identifier hs-var">pName</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181631"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>      </span><span id="local-6989586621679181639"><span class="annot"><span class="annottext">alts :: [Port]
</span><a href="#local-6989586621679181639"><span class="hs-identifier hs-var hs-var">alts</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Port] -&gt; (Int, Ident) -&gt; AliasMap -&gt; [Port]
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">M.findWithDefault</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Int, Ident)
</span><a href="#local-6989586621679181634"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildS -&gt; AliasMap
</span><a href="Synthesis.Builder.html#bsAliases"><span class="hs-identifier hs-var">bsAliases</span></a></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181633"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>      </span><span id="local-6989586621679181641"><span class="annot"><span class="annottext">allPs :: [Port]
</span><a href="#local-6989586621679181641"><span class="hs-identifier hs-var hs-var">allPs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181631"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Port -&gt; [Port] -&gt; [Port]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679181639"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><span class="annottext">BuildS -&gt; StateT BuildS Unique ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181633"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#bsGraph"><span class="hs-identifier hs-var">bsGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679181643"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181643"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679181644"><span class="annot"><span class="annottext">DFG
</span><a href="#local-6989586621679181644"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Edge -&gt; DFG -&gt; DFG
forall n. Edge -&gt; DGraph n -&gt; DGraph n
</span><a href="Types.html#addEdge"><span class="hs-identifier hs-var">addEdge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181643"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Edge
</span><a href="Port.html#--%3E"><span class="hs-operator hs-var">--&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181632"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DFG
</span><a href="#local-6989586621679181644"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Synthesis.Builder.html#bsGraph"><span class="hs-identifier hs-var">bsGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181633"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679181641"><span class="hs-identifier hs-type">allPs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- n&#243;s ------------------------------------------------------------------</span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="annot"><span class="hs-comment">-- | Create a new node with label and payload, returning its 'NodeId'.</span></span><span>
</span><span id="line-157"></span><span class="annot"><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-type">newNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Node.html#DNode"><span class="hs-identifier hs-type">DNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Types.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span>
</span><span id="line-158"></span><span id="newNode"><span class="annot"><span class="annottext">newNode :: Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var hs-var">newNode</span></a></span></span><span> </span><span id="local-6989586621679181646"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181646"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621679181647"><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181647"><span class="hs-identifier hs-var">nd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique Int -&gt; Build Int
forall a. StateT BuildS Unique a -&gt; Build a
</span><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BuildS Unique Int -&gt; Build Int)
-&gt; StateT BuildS Unique Int -&gt; Build Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-159"></span><span>  </span><span id="local-6989586621679181648"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181648"><span class="hs-identifier hs-var">s</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique BuildS
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-160"></span><span>  </span><span id="local-6989586621679181649"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181649"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Unique Int -&gt; StateT BuildS Unique Int
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT BuildS m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">Unique Int
forall (m :: * -&gt; *). MonadUnique m =&gt; m Int
</span><a href="Unique.html#freshId"><span class="hs-identifier hs-var">freshId</span></a></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679181650"><span class="annot"><span class="annottext">g' :: DFG
</span><a href="#local-6989586621679181650"><span class="hs-identifier hs-var hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; DNode -&gt; DFG -&gt; DFG
forall n. Int -&gt; n -&gt; DGraph n -&gt; DGraph n
</span><a href="Types.html#addNode"><span class="hs-identifier hs-var">addNode</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181649"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; DNode
</span><a href="Synthesis.Builder.html#setName"><span class="hs-identifier hs-var">setName</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181646"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181647"><span class="hs-identifier hs-var">nd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildS -&gt; DFG
</span><a href="Synthesis.Builder.html#bsGraph"><span class="hs-identifier hs-var">bsGraph</span></a></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181648"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><span class="annottext">BuildS -&gt; StateT BuildS Unique ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181648"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#bsGraph"><span class="hs-identifier hs-var">bsGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181650"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; StateT BuildS Unique Int
forall a. a -&gt; StateT BuildS Unique a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181649"><span class="hs-identifier hs-var">nid</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="annot"><span class="hs-comment">-- | Create an n-ary node and connect sequential inputs to its ports.</span></span><span>
</span><span id="line-166"></span><span class="annot"><a href="Synthesis.Builder.html#naryNode"><span class="hs-identifier hs-type">naryNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Node.html#DNode"><span class="hs-identifier hs-type">DNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Types.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span>
</span><span id="line-167"></span><span id="naryNode"><span class="annot"><span class="annottext">naryNode :: Ident -&gt; DNode -&gt; [Port] -&gt; Build Int
</span><a href="Synthesis.Builder.html#naryNode"><span class="hs-identifier hs-var hs-var">naryNode</span></a></span></span><span> </span><span id="local-6989586621679181653"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181653"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621679181654"><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181654"><span class="hs-identifier hs-var">nd</span></a></span></span><span> </span><span id="local-6989586621679181655"><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679181655"><span class="hs-identifier hs-var">ins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-168"></span><span>  </span><span id="local-6989586621679181656"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181656"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181653"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181654"><span class="hs-identifier hs-var">nd</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><span class="annottext">(Integer -&gt; Port -&gt; Build ()) -&gt; [Integer] -&gt; [Port] -&gt; Build ()
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m ()
</span><span class="hs-identifier hs-var">zipWithM_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679181657"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679181657"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679181658"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181658"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connectPlus"><span class="hs-identifier hs-var">connectPlus</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181658"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181656"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Ident
forall a. Show a =&gt; a -&gt; Ident
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679181657"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679181655"><span class="hs-identifier hs-var">ins</span></a></span><span>
</span><span id="line-170"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Build Int
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181656"><span class="hs-identifier hs-var">nid</span></a></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="annot"><span class="hs-comment">-- | Convenience accessor for the first output port of a node.</span></span><span>
</span><span id="line-173"></span><span class="annot"><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-type">out0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-174"></span><span id="out0"><span class="annot"><span class="annottext">out0 :: Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var hs-var">out0</span></a></span></span><span> </span><span id="local-6989586621679181662"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181662"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181662"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="annot"><span class="hs-comment">-- | Write a display name into a 'DNode' (for debugging/graphs).</span></span><span>
</span><span id="line-177"></span><span class="annot"><a href="Synthesis.Builder.html#setName"><span class="hs-identifier hs-type">setName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Node.html#DNode"><span class="hs-identifier hs-type">DNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Node.html#DNode"><span class="hs-identifier hs-type">DNode</span></a></span><span>
</span><span id="line-178"></span><span id="setName"><span class="annot"><span class="annottext">setName :: Ident -&gt; DNode -&gt; DNode
</span><a href="Synthesis.Builder.html#setName"><span class="hs-identifier hs-var hs-var">setName</span></a></span></span><span> </span><span id="local-6989586621679181663"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181663"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679181664"><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><a href="Node.html#NConstI"><span class="hs-identifier hs-type">NConstI</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-180"></span><span>  </span><span class="annot"><a href="Node.html#NConstF"><span class="hs-identifier hs-type">NConstF</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-181"></span><span>  </span><span class="annot"><a href="Node.html#NConstD"><span class="hs-identifier hs-type">NConstD</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><a href="Node.html#NAdd"><span class="hs-identifier hs-type">NAdd</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><a href="Node.html#NSub"><span class="hs-identifier hs-type">NSub</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><a href="Node.html#NMul"><span class="hs-identifier hs-type">NMul</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-185"></span><span>  </span><span class="annot"><a href="Node.html#NDiv"><span class="hs-identifier hs-type">NDiv</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-186"></span><span>  </span><span class="annot"><a href="Node.html#NAddI"><span class="hs-identifier hs-type">NAddI</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><a href="Node.html#NSubI"><span class="hs-identifier hs-type">NSubI</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><a href="Node.html#NMulI"><span class="hs-identifier hs-type">NMulI</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-189"></span><span>  </span><span class="annot"><a href="Node.html#NFMulI"><span class="hs-identifier hs-type">NFMulI</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><a href="Node.html#NDivI"><span class="hs-identifier hs-type">NDivI</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-191"></span><span>  </span><span class="annot"><a href="Node.html#NFAdd"><span class="hs-identifier hs-type">NFAdd</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-192"></span><span>  </span><span class="annot"><a href="Node.html#NFSub"><span class="hs-identifier hs-type">NFSub</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-193"></span><span>  </span><span class="annot"><a href="Node.html#NFMul"><span class="hs-identifier hs-type">NFMul</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-194"></span><span>  </span><span class="annot"><a href="Node.html#NFDiv"><span class="hs-identifier hs-type">NFDiv</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-195"></span><span>  </span><span class="annot"><a href="Node.html#NDAdd"><span class="hs-identifier hs-type">NDAdd</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-196"></span><span>  </span><span class="annot"><a href="Node.html#NBand"><span class="hs-identifier hs-type">NBand</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><a href="Node.html#NSteer"><span class="hs-identifier hs-type">NSteer</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-198"></span><span>  </span><span class="annot"><a href="Node.html#NLThan"><span class="hs-identifier hs-type">NLThan</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><a href="Node.html#NGThan"><span class="hs-identifier hs-type">NGThan</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-200"></span><span>  </span><span class="annot"><a href="Node.html#NEqual"><span class="hs-identifier hs-type">NEqual</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><a href="Node.html#NLThanI"><span class="hs-identifier hs-type">NLThanI</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-202"></span><span>  </span><span class="annot"><a href="Node.html#NGThanI"><span class="hs-identifier hs-type">NGThanI</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-203"></span><span>  </span><span class="annot"><a href="Node.html#NCallGroup"><span class="hs-identifier hs-type">NCallGroup</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-204"></span><span>  </span><span class="annot"><a href="Node.html#NCallSnd"><span class="hs-identifier hs-type">NCallSnd</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-205"></span><span>  </span><span class="annot"><a href="Node.html#NRetSnd"><span class="hs-identifier hs-type">NRetSnd</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-206"></span><span>  </span><span class="annot"><a href="Node.html#NRet"><span class="hs-identifier hs-type">NRet</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><a href="Node.html#NTagVal"><span class="hs-identifier hs-type">NTagVal</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><a href="Node.html#NValTag"><span class="hs-identifier hs-type">NValTag</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-209"></span><span>  </span><span class="annot"><a href="Node.html#NCpHToDev"><span class="hs-identifier hs-type">NCpHToDev</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><a href="Node.html#NCpDevToH"><span class="hs-identifier hs-type">NCpDevToH</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><a href="Node.html#NCommit"><span class="hs-identifier hs-type">NCommit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><a href="Node.html#NStopSpec"><span class="hs-identifier hs-type">NStopSpec</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-213"></span><span>  </span><span class="annot"><a href="Node.html#NArg"><span class="hs-identifier hs-type">NArg</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><a href="Node.html#NSuper"><span class="hs-identifier hs-type">NSuper</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181664"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181663"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-comment">-- codifica&#231;&#227;o pares/listas ---------------------------------------------</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="annot"><span class="hs-comment">-- | Base constant used by the pair encoding scheme.</span></span><span>
</span><span id="line-219"></span><span class="annot"><a href="Synthesis.Builder.html#pairBase"><span class="hs-identifier hs-type">pairBase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-220"></span><span id="pairBase"><span class="annot"><span class="annottext">pairBase :: Int
</span><a href="Synthesis.Builder.html#pairBase"><span class="hs-identifier hs-var hs-var">pairBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000003</span></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span class="annot"><span class="hs-comment">-- | Emit an integer constant node.</span></span><span>
</span><span id="line-223"></span><span class="annot"><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-type">constI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-224"></span><span id="constI"><span class="annot"><span class="annottext">constI :: Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var hs-var">constI</span></a></span></span><span> </span><span id="local-6989586621679181704"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181704"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;const_&quot;</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Ident -&gt; Ident
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ident
forall a. Show a =&gt; a -&gt; Ident
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181704"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; Int -&gt; DNode
</span><a href="Node.html#NConstI"><span class="hs-identifier hs-var">NConstI</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181704"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Build Int -&gt; (Int -&gt; Build Port) -&gt; Build Port
forall a b. Build a -&gt; (a -&gt; Build b) -&gt; Build b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679181705"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181705"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181705"><span class="hs-identifier hs-var">nid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-comment">-- immediates (sem aliases!)</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="annot"><span class="hs-comment">-- | Add immediate @k@ to input (no alias expansion).</span></span><span>
</span><span id="line-229"></span><span class="annot"><a href="Synthesis.Builder.html#addI"><span class="hs-identifier hs-type">addI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-230"></span><span id="addI"><span class="annot"><span class="annottext">addI :: Port -&gt; Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#addI"><span class="hs-identifier hs-var hs-var">addI</span></a></span></span><span> </span><span id="local-6989586621679181707"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181707"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679181708"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181708"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-231"></span><span>  </span><span id="local-6989586621679181709"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181709"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;addi_&quot;</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Ident -&gt; Ident
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ident
forall a. Show a =&gt; a -&gt; Ident
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181708"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; Int -&gt; DNode
</span><a href="Node.html#NAddI"><span class="hs-identifier hs-var">NAddI</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181708"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>  </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connect"><span class="hs-identifier hs-var">connect</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181707"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181709"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>  </span><span class="annot"><span class="annottext">Port -&gt; Build Port
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181709"><span class="hs-identifier hs-var">nid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="annot"><span class="hs-comment">-- | Subtract immediate @k@ from input (no alias expansion).</span></span><span>
</span><span id="line-236"></span><span class="annot"><a href="Synthesis.Builder.html#subI"><span class="hs-identifier hs-type">subI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-237"></span><span id="subI"><span class="annot"><span class="annottext">subI :: Port -&gt; Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#subI"><span class="hs-identifier hs-var hs-var">subI</span></a></span></span><span> </span><span id="local-6989586621679181711"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181711"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679181712"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181712"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-238"></span><span>  </span><span id="local-6989586621679181713"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181713"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;subi_&quot;</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Ident -&gt; Ident
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ident
forall a. Show a =&gt; a -&gt; Ident
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181712"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; Int -&gt; DNode
</span><a href="Node.html#NSubI"><span class="hs-identifier hs-var">NSubI</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181712"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connect"><span class="hs-identifier hs-var">connect</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181711"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181713"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><span class="annottext">Port -&gt; Build Port
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181713"><span class="hs-identifier hs-var">nid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-comment">-- fmuli helper (sem aliases!)</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="annot"><span class="hs-comment">-- | Multiply by a floating immediate (no alias expansion).</span></span><span>
</span><span id="line-245"></span><span class="annot"><a href="Synthesis.Builder.html#fmulI"><span class="hs-identifier hs-type">fmulI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-246"></span><span id="fmulI"><span class="annot"><span class="annottext">fmulI :: Port -&gt; Float -&gt; Build Port
</span><a href="Synthesis.Builder.html#fmulI"><span class="hs-identifier hs-var hs-var">fmulI</span></a></span></span><span> </span><span id="local-6989586621679181715"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181715"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679181716"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679181716"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-247"></span><span>  </span><span id="local-6989586621679181717"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181717"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;fmuli_&quot;</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Ident -&gt; Ident
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Ident
forall a. Show a =&gt; a -&gt; Ident
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679181716"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; Float -&gt; DNode
</span><a href="Node.html#NFMulI"><span class="hs-identifier hs-var">NFMulI</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679181716"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>  </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connect"><span class="hs-identifier hs-var">connect</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181715"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181717"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><span class="annottext">Port -&gt; Build Port
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181717"><span class="hs-identifier hs-var">nid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="annot"><span class="hs-comment">-- | Port representing the empty list.</span></span><span>
</span><span id="line-252"></span><span class="annot"><a href="Synthesis.Builder.html#nilP"><span class="hs-identifier hs-type">nilP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-253"></span><span id="nilP"><span class="annot"><span class="annottext">nilP :: Build Port
</span><a href="Synthesis.Builder.html#nilP"><span class="hs-identifier hs-var hs-var">nilP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var">constI</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span class="annot"><span class="hs-comment">-- | Predicate: is the list port equal to 'nilP'?</span></span><span>
</span><span id="line-256"></span><span class="annot"><a href="Synthesis.Builder.html#isNilP"><span class="hs-identifier hs-type">isNilP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-257"></span><span id="isNilP"><span class="annot"><span class="annottext">isNilP :: Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#isNilP"><span class="hs-identifier hs-var hs-var">isNilP</span></a></span></span><span> </span><span id="local-6989586621679181720"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181720"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-258"></span><span>  </span><span id="local-6989586621679181721"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181721"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Build Port
</span><a href="Synthesis.Builder.html#nilP"><span class="hs-identifier hs-var">nilP</span></a></span><span>
</span><span id="line-259"></span><span>  </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;equal&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NEqual"><span class="hs-identifier hs-var">NEqual</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181720"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181721"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="hs-comment">-- cons(a,b) = (a+2)*B + (b+2)</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="annot"><span class="hs-comment">-- | Encode a pair/list cell via the affine scheme using 'pairBase'.</span></span><span>
</span><span id="line-264"></span><span class="annot"><a href="Synthesis.Builder.html#pairEnc"><span class="hs-identifier hs-type">pairEnc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-265"></span><span id="pairEnc"><span class="annot"><span class="annottext">pairEnc :: Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#pairEnc"><span class="hs-identifier hs-var hs-var">pairEnc</span></a></span></span><span> </span><span id="local-6989586621679181724"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181724"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679181725"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181725"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-266"></span><span>  </span><span id="local-6989586621679181726"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181726"><span class="hs-identifier hs-var">a2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#addI"><span class="hs-identifier hs-var">addI</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181724"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-267"></span><span>  </span><span id="local-6989586621679181727"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181727"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#addI"><span class="hs-identifier hs-var">addI</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181725"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-268"></span><span>  </span><span id="local-6989586621679181728"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181728"><span class="hs-identifier hs-var">k</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var">constI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Synthesis.Builder.html#pairBase"><span class="hs-identifier hs-var">pairBase</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span id="local-6989586621679181729"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181729"><span class="hs-identifier hs-var">m</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Int
</span><a href="Synthesis.Builder.html#bin2Node"><span class="hs-identifier hs-var">bin2Node</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;mul&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NMul"><span class="hs-identifier hs-var">NMul</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181726"><span class="hs-identifier hs-var">a2</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181728"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-270"></span><span>  </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;add&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NAdd"><span class="hs-identifier hs-var">NAdd</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181729"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181727"><span class="hs-identifier hs-var">b2</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="annot"><span class="hs-comment">-- | Decode first component from encoded pair.</span></span><span>
</span><span id="line-273"></span><span class="annot"><a href="Synthesis.Builder.html#fstDec"><span class="hs-identifier hs-type">fstDec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-274"></span><span id="fstDec"><span class="annot"><span class="annottext">fstDec :: Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#fstDec"><span class="hs-identifier hs-var hs-var">fstDec</span></a></span></span><span> </span><span id="local-6989586621679181732"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181732"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-275"></span><span>  </span><span id="local-6989586621679181733"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181733"><span class="hs-identifier hs-var">k</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var">constI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Synthesis.Builder.html#pairBase"><span class="hs-identifier hs-var">pairBase</span></a></span><span>
</span><span id="line-276"></span><span>  </span><span id="local-6989586621679181734"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181734"><span class="hs-identifier hs-var">qN</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Int
</span><a href="Synthesis.Builder.html#bin2Node"><span class="hs-identifier hs-var">bin2Node</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;div&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NDiv"><span class="hs-identifier hs-var">NDiv</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181732"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181733"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-277"></span><span>  </span><span class="annot"><span class="annottext">Port -&gt; Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#subI"><span class="hs-identifier hs-var">subI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181734"><span class="hs-identifier hs-var">qN</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="annot"><span class="hs-comment">-- | Decode second component from encoded pair.</span></span><span>
</span><span id="line-280"></span><span class="annot"><a href="Synthesis.Builder.html#sndDec"><span class="hs-identifier hs-type">sndDec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-281"></span><span id="sndDec"><span class="annot"><span class="annottext">sndDec :: Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#sndDec"><span class="hs-identifier hs-var hs-var">sndDec</span></a></span></span><span> </span><span id="local-6989586621679181736"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181736"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-282"></span><span>  </span><span id="local-6989586621679181737"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181737"><span class="hs-identifier hs-var">k</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var">constI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Synthesis.Builder.html#pairBase"><span class="hs-identifier hs-var">pairBase</span></a></span><span>
</span><span id="line-283"></span><span>  </span><span id="local-6989586621679181738"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181738"><span class="hs-identifier hs-var">qN</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Int
</span><a href="Synthesis.Builder.html#bin2Node"><span class="hs-identifier hs-var">bin2Node</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;div&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NDiv"><span class="hs-identifier hs-var">NDiv</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181736"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181737"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-284"></span><span>  </span><span id="local-6989586621679181739"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181739"><span class="hs-identifier hs-var">mN</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Int
</span><a href="Synthesis.Builder.html#bin2Node"><span class="hs-identifier hs-var">bin2Node</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;mul&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NMul"><span class="hs-identifier hs-var">NMul</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181738"><span class="hs-identifier hs-var">qN</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181737"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-285"></span><span>  </span><span id="local-6989586621679181740"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181740"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;sub&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NSub"><span class="hs-identifier hs-var">NSub</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181736"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181739"><span class="hs-identifier hs-var">mN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><span class="annottext">Port -&gt; Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#subI"><span class="hs-identifier hs-var">subI</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181740"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="annot"><span class="hs-comment">-- | Local right-associative monadic fold (used for list construction).</span></span><span>
</span><span id="line-289"></span><span id="local-6989586621679181130"><span id="local-6989586621679181131"><span class="annot"><a href="Synthesis.Builder.html#foldrM%27"><span class="hs-identifier hs-type">foldrM'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679181130"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679181131"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181131"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679181131"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679181130"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181131"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-290"></span><span id="foldrM%27"><span class="annot"><span class="annottext">foldrM' :: forall a b. (a -&gt; b -&gt; Build b) -&gt; b -&gt; [a] -&gt; Build b
</span><a href="Synthesis.Builder.html#foldrM%27"><span class="hs-identifier hs-var hs-var">foldrM'</span></a></span></span><span> </span><span id="local-6989586621679181742"><span class="annot"><span class="annottext">a -&gt; b -&gt; Build b
</span><a href="#local-6989586621679181742"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679181743"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679181743"><span class="hs-identifier hs-var">z0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Build b
</span><a href="#local-6989586621679181744"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-292"></span><span>    </span><span id="local-6989586621679181744"><span class="annot"><span class="annottext">go :: [a] -&gt; Build b
</span><a href="#local-6989586621679181744"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b -&gt; Build b
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679181743"><span class="hs-identifier hs-var">z0</span></a></span><span>
</span><span id="line-293"></span><span>    </span><span class="annot"><a href="#local-6989586621679181744"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679181747"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679181747"><span class="hs-identifier hs-var">y</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679181748"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679181748"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679181749"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679181749"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Build b
</span><a href="#local-6989586621679181744"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679181748"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-294"></span><span>                   </span><span class="annot"><span class="annottext">a -&gt; b -&gt; Build b
</span><a href="#local-6989586621679181742"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679181747"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679181749"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-comment">-- API ------------------------------------------------------------------</span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span class="annot"><span class="hs-comment">-- | Build a 'DFG' from a 'Program'. Also assigns super names first.</span></span><span>
</span><span id="line-299"></span><span class="annot"><a href="Synthesis.Builder.html#buildProgram"><span class="hs-identifier hs-type">buildProgram</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#DFG"><span class="hs-identifier hs-type">DFG</span></a></span><span>
</span><span id="line-300"></span><span id="buildProgram"><span class="annot"><span class="annottext">buildProgram :: Program -&gt; DFG
</span><a href="Synthesis.Builder.html#buildProgram"><span class="hs-identifier hs-var hs-var">buildProgram</span></a></span></span><span> </span><span id="local-6989586621679181750"><span class="annot"><span class="annottext">Program
</span><a href="#local-6989586621679181750"><span class="hs-identifier hs-var">p0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Syntax.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span> </span><span id="local-6989586621679181751"><span class="annot"><span class="annottext">[Decl]
</span><a href="#local-6989586621679181751"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Program -&gt; Program
</span><a href="Semantic.html#assignSuperNames"><span class="hs-identifier hs-var">assignSuperNames</span></a></span><span> </span><span class="annot"><span class="annottext">Program
</span><a href="#local-6989586621679181750"><span class="hs-identifier hs-var">p0</span></a></span><span>
</span><span id="line-302"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679181757"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181757"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Build () -&gt; ((), BuildS)
forall a. Build a -&gt; (a, BuildS)
</span><a href="Synthesis.Builder.html#runBuild"><span class="hs-identifier hs-var">runBuild</span></a></span><span> </span><span class="annot"><span class="annottext">(Build () -&gt; ((), BuildS)) -&gt; Build () -&gt; ((), BuildS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-303"></span><span>        </span><span class="annot"><span class="annottext">(Decl -&gt; Build ()) -&gt; [Decl] -&gt; Build ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Syntax.html#FunDecl"><span class="hs-identifier hs-type">FunDecl</span></a></span><span> </span><span id="local-6989586621679181760"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181760"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679181761"><span class="annot"><span class="annottext">ActiveStack
</span><a href="#local-6989586621679181761"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679181762"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181762"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Binding -&gt; Build ()
</span><a href="Synthesis.Builder.html#insertB"><span class="hs-identifier hs-var">insertB</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181760"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActiveStack -&gt; Expr -&gt; Binding
</span><a href="Synthesis.Builder.html#BLam"><span class="hs-identifier hs-var">BLam</span></a></span><span> </span><span class="annot"><span class="annottext">ActiveStack
</span><a href="#local-6989586621679181761"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181762"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Decl]
</span><a href="#local-6989586621679181751"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><span class="annottext">(Decl -&gt; Build ()) -&gt; [Decl] -&gt; Build ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Decl -&gt; Build ()
</span><a href="#local-6989586621679181763"><span class="hs-identifier hs-var">buildZero</span></a></span><span> </span><span class="annot"><span class="annottext">[Decl]
</span><a href="#local-6989586621679181751"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BuildS -&gt; DFG
</span><a href="Synthesis.Builder.html#bsGraph"><span class="hs-identifier hs-var">bsGraph</span></a></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181757"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-comment">-- | Build and expose zero-argument functions as graph roots.</span><span>
</span><span id="line-308"></span><span>    </span><span id="local-6989586621679181763"><span class="annot"><span class="annottext">buildZero :: Decl -&gt; Build ()
</span><a href="#local-6989586621679181763"><span class="hs-identifier hs-var hs-var">buildZero</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Syntax.html#FunDecl"><span class="hs-identifier hs-type">FunDecl</span></a></span><span> </span><span id="local-6989586621679181769"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181769"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679181770"><span class="annot"><span class="annottext">ActiveStack
</span><a href="#local-6989586621679181770"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679181771"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181771"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ActiveStack -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">ActiveStack
</span><a href="#local-6989586621679181770"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-309"></span><span>      </span><span id="local-6989586621679181773"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181773"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Build Port -&gt; Build Port
forall a. Build a -&gt; Build a
</span><a href="Synthesis.Builder.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181771"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>      </span><span class="annot"><span class="annottext">Ident -&gt; Binding -&gt; Build ()
</span><a href="Synthesis.Builder.html#insertB"><span class="hs-identifier hs-var">insertB</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181769"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port -&gt; Binding
</span><a href="Synthesis.Builder.html#BPort"><span class="hs-identifier hs-var">BPort</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181773"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>      </span><span id="local-6989586621679181775"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181775"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181769"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NRet"><span class="hs-identifier hs-var">NRet</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181769"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>      </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connectPlus"><span class="hs-identifier hs-var">connectPlus</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181773"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181775"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>    </span><span class="annot"><a href="#local-6989586621679181763"><span class="hs-identifier hs-var">buildZero</span></a></span><span> </span><span class="annot"><span class="annottext">Decl
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; Build ()
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="hs-comment">-- fun&#231;&#227;o j&#225; constru&#237;da?</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="annot"><span class="hs-comment">-- | Has a return node for the given function @f@ already been emitted?</span></span><span>
</span><span id="line-318"></span><span class="annot"><a href="Synthesis.Builder.html#funBuilt"><span class="hs-identifier hs-type">funBuilt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-319"></span><span id="funBuilt"><span class="annot"><span class="annottext">funBuilt :: Ident -&gt; Build Bool
</span><a href="Synthesis.Builder.html#funBuilt"><span class="hs-identifier hs-var hs-var">funBuilt</span></a></span></span><span> </span><span id="local-6989586621679181777"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181777"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique Bool -&gt; Build Bool
forall a. StateT BuildS Unique a -&gt; Build a
</span><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BuildS Unique Bool -&gt; Build Bool)
-&gt; StateT BuildS Unique Bool -&gt; Build Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BuildS -&gt; Bool) -&gt; StateT BuildS Unique Bool
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((BuildS -&gt; Bool) -&gt; StateT BuildS Unique Bool)
-&gt; (BuildS -&gt; Bool) -&gt; StateT BuildS Unique Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679181778"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181778"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((Int, DNode) -&gt; Bool) -&gt; [(Int, DNode)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">(Int, DNode) -&gt; Bool
forall {a}. (a, DNode) -&gt; Bool
</span><a href="#local-6989586621679181780"><span class="hs-identifier hs-var">isRet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Int DNode -&gt; [(Int, DNode)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFG -&gt; Map Int DNode
forall n. DGraph n -&gt; Map Int n
</span><a href="Types.html#dgNodes"><span class="hs-identifier hs-var">dgNodes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildS -&gt; DFG
</span><a href="Synthesis.Builder.html#bsGraph"><span class="hs-identifier hs-var">bsGraph</span></a></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181778"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679181780"><span class="annot"><span class="annottext">isRet :: (a, DNode) -&gt; Bool
</span><a href="#local-6989586621679181780"><span class="hs-identifier hs-var hs-var">isRet</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679181785"><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181785"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181785"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Node.html#NRet"><span class="hs-identifier hs-type">NRet</span></a></span><span> </span><span id="local-6989586621679181786"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181786"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181786"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Ident -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181777"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">DNode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span class="hs-comment">-- evita reentrada recursiva</span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span class="annot"><span class="hs-comment">-- | Ensure a function @f@ is built at most once; guard against recursion.</span></span><span>
</span><span id="line-325"></span><span class="annot"><a href="Synthesis.Builder.html#ensureBuilt"><span class="hs-identifier hs-type">ensureBuilt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Syntax.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span id="ensureBuilt"><span class="annot"><span class="annottext">ensureBuilt :: Ident -&gt; ActiveStack -&gt; Expr -&gt; Build ()
</span><a href="Synthesis.Builder.html#ensureBuilt"><span class="hs-identifier hs-var hs-var">ensureBuilt</span></a></span></span><span> </span><span id="local-6989586621679181788"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181788"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679181789"><span class="annot"><span class="annottext">ActiveStack
</span><a href="#local-6989586621679181789"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679181790"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181790"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-327"></span><span>  </span><span id="local-6989586621679181791"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181791"><span class="hs-identifier hs-var">done</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Build Bool
</span><a href="Synthesis.Builder.html#funBuilt"><span class="hs-identifier hs-var">funBuilt</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181788"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-328"></span><span>  </span><span id="local-6989586621679181792"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181792"><span class="hs-identifier hs-var">active</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Build Bool
</span><a href="Synthesis.Builder.html#isActiveFun"><span class="hs-identifier hs-var">isActiveFun</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181788"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-329"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181791"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181792"><span class="hs-identifier hs-var">active</span></a></span><span>
</span><span id="line-330"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; Build ()
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-332"></span><span>       </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Build () -&gt; Build ()
forall a. Ident -&gt; Build a -&gt; Build a
</span><a href="Synthesis.Builder.html#withActive"><span class="hs-identifier hs-var">withActive</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181788"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Build () -&gt; Build ()) -&gt; Build () -&gt; Build ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Build () -&gt; Build ()
forall a. Build a -&gt; Build a
</span><a href="Synthesis.Builder.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Build () -&gt; Build ()) -&gt; Build () -&gt; Build ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-333"></span><span>              </span><span class="annot"><span class="annottext">[(Int, Ident)] -&gt; ((Int, Ident) -&gt; Build ()) -&gt; Build ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; ActiveStack -&gt; [(Int, Ident)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ActiveStack
</span><a href="#local-6989586621679181789"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((Int, Ident) -&gt; Build ()) -&gt; Build ())
-&gt; ((Int, Ident) -&gt; Build ()) -&gt; Build ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679181795"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181795"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679181796"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181796"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-334"></span><span>                </span><span id="local-6989586621679181797"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181797"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#argNode"><span class="hs-identifier hs-var">argNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181788"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181795"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-335"></span><span>                </span><span class="annot"><span class="annottext">Ident -&gt; Binding -&gt; Build ()
</span><a href="Synthesis.Builder.html#insertB"><span class="hs-identifier hs-var">insertB</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181796"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port -&gt; Binding
</span><a href="Synthesis.Builder.html#BPort"><span class="hs-identifier hs-var">BPort</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181797"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>              </span><span id="local-6989586621679181799"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181799"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181790"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-337"></span><span>              </span><span id="local-6989586621679181800"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181800"><span class="hs-identifier hs-var">r</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181788"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NRet"><span class="hs-identifier hs-var">NRet</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181788"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>              </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connectPlus"><span class="hs-identifier hs-var">connectPlus</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181799"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181800"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>       </span><span class="annot"><span class="annottext">() -&gt; Build ()
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="hs-comment">-- vari&#225;vel livre -&gt; NArg</span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span class="annot"><span class="hs-comment">-- | Treat an unbound variable as a free 'NArg' input node.</span></span><span>
</span><span id="line-344"></span><span class="annot"><a href="Synthesis.Builder.html#freeVar"><span class="hs-identifier hs-type">freeVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-345"></span><span id="freeVar"><span class="annot"><span class="annottext">freeVar :: Ident -&gt; Build Port
</span><a href="Synthesis.Builder.html#freeVar"><span class="hs-identifier hs-var hs-var">freeVar</span></a></span></span><span> </span><span id="local-6989586621679181802"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181802"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-346"></span><span>  </span><span id="local-6989586621679181803"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181803"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181802"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NArg"><span class="hs-identifier hs-var">NArg</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181802"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679181804"><span class="annot"><span class="annottext">p :: Port
</span><a href="#local-6989586621679181804"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181803"><span class="hs-identifier hs-var">nid</span></a></span><span>
</span><span id="line-348"></span><span>  </span><span class="annot"><span class="annottext">Ident -&gt; Binding -&gt; Build ()
</span><a href="Synthesis.Builder.html#insertB"><span class="hs-identifier hs-var">insertB</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181802"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port -&gt; Binding
</span><a href="Synthesis.Builder.html#BPort"><span class="hs-identifier hs-var">BPort</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181804"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>  </span><span class="annot"><span class="annottext">Port -&gt; Build Port
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181804"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="hs-comment">-- detecta se um Port carrega float (por origem)</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="annot"><span class="hs-comment">-- | Heuristically check if a port originates from floating-point ops/values.</span></span><span>
</span><span id="line-354"></span><span class="annot"><a href="Synthesis.Builder.html#portIsFloat"><span class="hs-identifier hs-type">portIsFloat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-355"></span><span id="portIsFloat"><span class="annot"><span class="annottext">portIsFloat :: Port -&gt; Build Bool
</span><a href="Synthesis.Builder.html#portIsFloat"><span class="hs-identifier hs-var hs-var">portIsFloat</span></a></span></span><span> </span><span id="local-6989586621679181806"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181806"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique Bool -&gt; Build Bool
forall a. StateT BuildS Unique a -&gt; Build a
</span><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BuildS Unique Bool -&gt; Build Bool)
-&gt; StateT BuildS Unique Bool -&gt; Build Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BuildS -&gt; Bool) -&gt; StateT BuildS Unique Bool
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((BuildS -&gt; Bool) -&gt; StateT BuildS Unique Bool)
-&gt; (BuildS -&gt; Bool) -&gt; StateT BuildS Unique Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679181807"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181807"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Map Int DNode -&gt; Maybe DNode
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port -&gt; Int
</span><a href="Port.html#pNode"><span class="hs-identifier hs-var">pNode</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181806"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFG -&gt; Map Int DNode
forall n. DGraph n -&gt; Map Int n
</span><a href="Types.html#dgNodes"><span class="hs-identifier hs-var">dgNodes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildS -&gt; DFG
</span><a href="Synthesis.Builder.html#bsGraph"><span class="hs-identifier hs-var">bsGraph</span></a></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181807"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-356"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="Node.html#NConstF"><span class="hs-identifier hs-type">NConstF</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-357"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="Node.html#NFAdd"><span class="hs-identifier hs-type">NFAdd</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-358"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="Node.html#NFSub"><span class="hs-identifier hs-type">NFSub</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-359"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="Node.html#NFMul"><span class="hs-identifier hs-type">NFMul</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-360"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="Node.html#NFDiv"><span class="hs-identifier hs-type">NFDiv</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-361"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Node.html#NRetSnd"><span class="hs-identifier hs-type">NRetSnd</span></a></span><span> </span><span id="local-6989586621679181808"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181808"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Set Ident -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">S.member</span></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181808"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildS -&gt; Set Ident
</span><a href="Synthesis.Builder.html#bsFloatFuns"><span class="hs-identifier hs-var">bsFloatFuns</span></a></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181807"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>  </span><span class="annot"><span class="annottext">Maybe DNode
</span><span class="hs-identifier">_</span></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="annot"><span class="hs-comment">-- | Is the current operation in a floating-point context?</span></span><span>
</span><span id="line-365"></span><span class="annot"><a href="Synthesis.Builder.html#isFloatContext"><span class="hs-identifier hs-type">isFloatContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-366"></span><span id="isFloatContext"><span class="annot"><span class="annottext">isFloatContext :: Port -&gt; Port -&gt; Build Bool
</span><a href="Synthesis.Builder.html#isFloatContext"><span class="hs-identifier hs-var hs-var">isFloatContext</span></a></span></span><span> </span><span id="local-6989586621679181810"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181810"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679181811"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181811"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-367"></span><span>  </span><span id="local-6989586621679181812"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181812"><span class="hs-identifier hs-var">af</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Build Bool
</span><a href="Synthesis.Builder.html#isFloatActive"><span class="hs-identifier hs-var">isFloatActive</span></a></span><span>
</span><span id="line-368"></span><span>  </span><span id="local-6989586621679181813"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181813"><span class="hs-identifier hs-var">pa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Bool
</span><a href="Synthesis.Builder.html#portIsFloat"><span class="hs-identifier hs-var">portIsFloat</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181810"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-369"></span><span>  </span><span id="local-6989586621679181814"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181814"><span class="hs-identifier hs-var">pb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Bool
</span><a href="Synthesis.Builder.html#portIsFloat"><span class="hs-identifier hs-var">portIsFloat</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181811"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-370"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Build Bool
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181812"><span class="hs-identifier hs-var">af</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181813"><span class="hs-identifier hs-var">pa</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181814"><span class="hs-identifier hs-var">pb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span class="hs-comment">-- Express&#245;es -----------------------------------------------------------</span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span class="annot"><span class="hs-comment">-- | Synthesize an expression into the graph and return its output 'Port'.</span></span><span>
</span><span id="line-375"></span><span class="annot"><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-type">goExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-376"></span><span id="goExpr"><span class="annot"><span class="annottext">goExpr :: Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var hs-var">goExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-377"></span><span>  </span><span class="annot"><a href="Syntax.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621679181816"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181816"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-378"></span><span>    </span><span class="annot"><span class="annottext">Ident -&gt; Build (Maybe Binding)
</span><a href="Synthesis.Builder.html#lookupB"><span class="hs-identifier hs-var">lookupB</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181816"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Build (Maybe Binding)
-&gt; (Maybe Binding -&gt; Build Port) -&gt; Build Port
forall a b. Build a -&gt; (a -&gt; Build b) -&gt; Build b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-379"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Synthesis.Builder.html#BPort"><span class="hs-identifier hs-type">BPort</span></a></span><span> </span><span id="local-6989586621679181817"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181817"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181817"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-380"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Synthesis.Builder.html#BLam"><span class="hs-identifier hs-type">BLam</span></a></span><span> </span><span id="local-6989586621679181818"><span class="annot"><span class="annottext">ActiveStack
</span><a href="#local-6989586621679181818"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679181819"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181819"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-381"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ActiveStack -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">ActiveStack
</span><a href="#local-6989586621679181818"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-382"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679181820"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181820"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Build Port -&gt; Build Port
forall a. Build a -&gt; Build a
</span><a href="Synthesis.Builder.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181819"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>                  </span><span class="annot"><span class="annottext">Ident -&gt; Binding -&gt; Build ()
</span><a href="Synthesis.Builder.html#insertB"><span class="hs-identifier hs-var">insertB</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181816"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port -&gt; Binding
</span><a href="Synthesis.Builder.html#BPort"><span class="hs-identifier hs-var">BPort</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181820"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>                  </span><span class="annot"><span class="annottext">Port -&gt; Build Port
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181820"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-385"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Build Port
</span><a href="Synthesis.Builder.html#freeVar"><span class="hs-identifier hs-var">freeVar</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181816"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-386"></span><span>      </span><span class="annot"><span class="annottext">Maybe Binding
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Build Port
</span><a href="Synthesis.Builder.html#freeVar"><span class="hs-identifier hs-var">freeVar</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181816"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>  </span><span class="annot"><a href="Syntax.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621679181822"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621679181822"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Build Port
</span><a href="Synthesis.Builder.html#litNode"><span class="hs-identifier hs-var">litNode</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621679181822"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>  </span><span class="annot"><a href="Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span id="local-6989586621679181825"><span class="annot"><span class="annottext">ActiveStack
</span><a href="#local-6989586621679181825"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679181826"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181826"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-391"></span><span>    </span><span class="annot"><span class="annottext">Build Port -&gt; Build Port
forall a. Build a -&gt; Build a
</span><a href="Synthesis.Builder.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Build Port -&gt; Build Port) -&gt; Build Port -&gt; Build Port
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-392"></span><span>      </span><span class="annot"><span class="annottext">(Ident -&gt; Build ()) -&gt; ActiveStack -&gt; Build ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679181827"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181827"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Binding -&gt; Build ()
</span><a href="Synthesis.Builder.html#insertB"><span class="hs-identifier hs-var">insertB</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181827"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port -&gt; Binding
</span><a href="Synthesis.Builder.html#BPort"><span class="hs-identifier hs-var">BPort</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181827"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ActiveStack
</span><a href="#local-6989586621679181825"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-393"></span><span>      </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181826"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span>  </span><span class="annot"><a href="Syntax.html#If"><span class="hs-identifier hs-type">If</span></a></span><span> </span><span id="local-6989586621679181829"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181829"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679181830"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181830"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679181831"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181831"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-396"></span><span>    </span><span id="local-6989586621679181832"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181832"><span class="hs-identifier hs-var">pc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181829"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-397"></span><span>    </span><span id="local-6989586621679181833"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181833"><span class="hs-identifier hs-var">vt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Build Port -&gt; Build Port
forall a. Build a -&gt; Build a
</span><a href="Synthesis.Builder.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181830"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>    </span><span id="local-6989586621679181834"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181834"><span class="hs-identifier hs-var">ve</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Build Port -&gt; Build Port
forall a. Build a -&gt; Build a
</span><a href="Synthesis.Builder.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181831"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span>    </span><span id="local-6989586621679181835"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181835"><span class="hs-identifier hs-var">stT</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;steer&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NSteer"><span class="hs-identifier hs-var">NSteer</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>    </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connect"><span class="hs-identifier hs-var">connect</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181833"><span class="hs-identifier hs-var">vt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181835"><span class="hs-identifier hs-var">stT</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>    </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connect"><span class="hs-identifier hs-var">connect</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181832"><span class="hs-identifier hs-var">pc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181835"><span class="hs-identifier hs-var">stT</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;1&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679181836"><span class="annot"><span class="annottext">outT :: Port
</span><a href="#local-6989586621679181836"><span class="hs-identifier hs-var hs-var">outT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#SteerPort"><span class="hs-identifier hs-var">SteerPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181835"><span class="hs-identifier hs-var">stT</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;t&quot;</span></span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span>    </span><span id="local-6989586621679181838"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181838"><span class="hs-identifier hs-var">stF</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;steer&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NSteer"><span class="hs-identifier hs-var">NSteer</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>    </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connect"><span class="hs-identifier hs-var">connect</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181834"><span class="hs-identifier hs-var">ve</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181838"><span class="hs-identifier hs-var">stF</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>    </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connect"><span class="hs-identifier hs-var">connect</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181832"><span class="hs-identifier hs-var">pc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181838"><span class="hs-identifier hs-var">stF</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;1&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679181839"><span class="annot"><span class="annottext">outF :: Port
</span><a href="#local-6989586621679181839"><span class="hs-identifier hs-var hs-var">outF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#SteerPort"><span class="hs-identifier hs-var">SteerPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181838"><span class="hs-identifier hs-var">stF</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;f&quot;</span></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>    </span><span class="annot"><span class="annottext">Port -&gt; [Port] -&gt; Build ()
</span><a href="Synthesis.Builder.html#registerAlias"><span class="hs-identifier hs-var">registerAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181836"><span class="hs-identifier hs-var">outT</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181839"><span class="hs-identifier hs-var">outF</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-411"></span><span>    </span><span class="annot"><span class="annottext">Port -&gt; Build Port
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181836"><span class="hs-identifier hs-var">outT</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-comment">-- listas / tuplas</span><span>
</span><span id="line-414"></span><span>  </span><span class="annot"><a href="Syntax.html#Cons"><span class="hs-identifier hs-type">Cons</span></a></span><span> </span><span id="local-6989586621679181841"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181841"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679181842"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181842"><span class="hs-identifier hs-var">b</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679181843"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181843"><span class="hs-identifier hs-var">pa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181841"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">;</span><span> </span><span id="local-6989586621679181844"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181844"><span class="hs-identifier hs-var">pb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181842"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#pairEnc"><span class="hs-identifier hs-var">pairEnc</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181843"><span class="hs-identifier hs-var">pa</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181844"><span class="hs-identifier hs-var">pb</span></a></span><span>
</span><span id="line-415"></span><span>  </span><span class="annot"><a href="Syntax.html#List"><span class="hs-identifier hs-type">List</span></a></span><span> </span><span id="local-6989586621679181846"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679181846"><span class="hs-identifier hs-var">xs</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679181847"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181847"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Build Port
</span><a href="Synthesis.Builder.html#nilP"><span class="hs-identifier hs-var">nilP</span></a></span><span class="hs-special">;</span><span> </span><span id="local-6989586621679181848"><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679181848"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Build Port) -&gt; [Expr] -&gt; Build [Port]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679181846"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Port -&gt; Port -&gt; Build Port) -&gt; Port -&gt; [Port] -&gt; Build Port
forall a b. (a -&gt; b -&gt; Build b) -&gt; b -&gt; [a] -&gt; Build b
</span><a href="Synthesis.Builder.html#foldrM%27"><span class="hs-identifier hs-var">foldrM'</span></a></span><span> </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#pairEnc"><span class="hs-identifier hs-var">pairEnc</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181847"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679181848"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-416"></span><span>  </span><span class="annot"><a href="Syntax.html#Tuple"><span class="hs-identifier hs-type">Tuple</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679181851"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181851"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679181852"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181852"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679181853"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181853"><span class="hs-identifier hs-var">pa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181851"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">;</span><span> </span><span id="local-6989586621679181854"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181854"><span class="hs-identifier hs-var">pb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181852"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#pairEnc"><span class="hs-identifier hs-var">pairEnc</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181853"><span class="hs-identifier hs-var">pa</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181854"><span class="hs-identifier hs-var">pb</span></a></span><span>
</span><span id="line-417"></span><span>  </span><span class="annot"><a href="Syntax.html#Tuple"><span class="hs-identifier hs-type">Tuple</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679181855"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181855"><span class="hs-identifier hs-var">a</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Expr]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181855"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-418"></span><span>  </span><span class="annot"><a href="Syntax.html#Tuple"><span class="hs-identifier hs-type">Tuple</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var">constI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span>  </span><span class="annot"><a href="Syntax.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span id="local-6989586621679181857"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181857"><span class="hs-identifier hs-var">scr</span></a></span></span><span> </span><span id="local-6989586621679181858"><span class="annot"><span class="annottext">[(Pattern, Expr)]
</span><a href="#local-6989586621679181858"><span class="hs-identifier hs-var">alts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; [(Pattern, Expr)] -&gt; Build Port
</span><a href="Synthesis.Builder.html#compileCase"><span class="hs-identifier hs-var">compileCase</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181857"><span class="hs-identifier hs-var">scr</span></a></span><span> </span><span class="annot"><span class="annottext">[(Pattern, Expr)]
</span><a href="#local-6989586621679181858"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span>  </span><span class="annot"><a href="Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621679181861"><span class="annot"><span class="annottext">[Decl]
</span><a href="#local-6989586621679181861"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span id="local-6989586621679181862"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181862"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Build Port -&gt; Build Port
forall a. Build a -&gt; Build a
</span><a href="Synthesis.Builder.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Decl -&gt; Build ()) -&gt; [Decl] -&gt; Build ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Decl -&gt; Build ()
</span><a href="Synthesis.Builder.html#goDecl"><span class="hs-identifier hs-var">goDecl</span></a></span><span> </span><span class="annot"><span class="annottext">[Decl]
</span><a href="#local-6989586621679181861"><span class="hs-identifier hs-var">decls</span></a></span><span> </span><span class="annot"><span class="annottext">Build () -&gt; Build Port -&gt; Build Port
forall a b. Build a -&gt; Build b -&gt; Build b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181862"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><a href="Syntax.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621679181865"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181865"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679181866"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181866"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679181867"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181867"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679181868"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679181868"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; (Expr, [Expr])
</span><a href="Synthesis.Builder.html#flattenApp"><span class="hs-identifier hs-var">flattenApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Expr -&gt; Expr
</span><a href="Syntax.html#App"><span class="hs-identifier hs-var">App</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181865"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181866"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; [Expr] -&gt; Build Port
</span><a href="Synthesis.Builder.html#goApp"><span class="hs-identifier hs-var">goApp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181867"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679181868"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span>  </span><span class="annot"><a href="Syntax.html#BinOp"><span class="hs-identifier hs-type">BinOp</span></a></span><span> </span><span id="local-6989586621679181872"><span class="annot"><span class="annottext">BinOperator
</span><a href="#local-6989586621679181872"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679181873"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181873"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679181874"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181874"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-427"></span><span>    </span><span id="local-6989586621679181875"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181873"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-428"></span><span>    </span><span id="local-6989586621679181876"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181874"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-429"></span><span>    </span><span id="local-6989586621679181877"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181877"><span class="hs-identifier hs-var">fctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build Bool
</span><a href="Synthesis.Builder.html#isFloatContext"><span class="hs-identifier hs-var">isFloatContext</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-430"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BinOperator
</span><a href="#local-6989586621679181872"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-431"></span><span>      </span><span class="annot"><span class="annottext">BinOperator
</span><a href="Syntax.html#Add"><span class="hs-identifier hs-var">Add</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181877"><span class="hs-identifier hs-var">fctx</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;fadd&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NFAdd"><span class="hs-identifier hs-var">NFAdd</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-432"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;add&quot;</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NAdd"><span class="hs-identifier hs-var">NAdd</span></a></span><span>  </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-433"></span><span>      </span><span class="annot"><span class="annottext">BinOperator
</span><a href="Syntax.html#Sub"><span class="hs-identifier hs-var">Sub</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181877"><span class="hs-identifier hs-var">fctx</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679181880"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181880"><span class="hs-identifier hs-var">ny</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Float -&gt; Build Port
</span><a href="Synthesis.Builder.html#fmulI"><span class="hs-identifier hs-var">fmulI</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">1.0</span></span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- fsub = fadd(x, y*-1)</span><span>
</span><span id="line-434"></span><span>                            </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;fadd&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NFAdd"><span class="hs-identifier hs-var">NFAdd</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181880"><span class="hs-identifier hs-var">ny</span></a></span><span>
</span><span id="line-435"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;sub&quot;</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NSub"><span class="hs-identifier hs-var">NSub</span></a></span><span>  </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-436"></span><span>      </span><span class="annot"><span class="annottext">BinOperator
</span><a href="Syntax.html#Mul"><span class="hs-identifier hs-var">Mul</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181877"><span class="hs-identifier hs-var">fctx</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;mul&quot;</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NMul"><span class="hs-identifier hs-var">NMul</span></a></span><span>  </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>  </span><span class="hs-comment">-- sem fmult no ASM</span><span>
</span><span id="line-437"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;mul&quot;</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NMul"><span class="hs-identifier hs-var">NMul</span></a></span><span>  </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-438"></span><span>      </span><span class="annot"><span class="annottext">BinOperator
</span><a href="Syntax.html#Div"><span class="hs-identifier hs-var">Div</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181877"><span class="hs-identifier hs-var">fctx</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;div&quot;</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NDiv"><span class="hs-identifier hs-var">NDiv</span></a></span><span>  </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>  </span><span class="hs-comment">-- sem fdiv no ASM</span><span>
</span><span id="line-439"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;div&quot;</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NDiv"><span class="hs-identifier hs-var">NDiv</span></a></span><span>  </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-440"></span><span>      </span><span class="annot"><span class="annottext">BinOperator
</span><a href="Syntax.html#Mod"><span class="hs-identifier hs-var">Mod</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-441"></span><span>        </span><span id="local-6989586621679181884"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181884"><span class="hs-identifier hs-var">qN</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Int
</span><a href="Synthesis.Builder.html#bin2Node"><span class="hs-identifier hs-var">bin2Node</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;div&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NDiv"><span class="hs-identifier hs-var">NDiv</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-442"></span><span>        </span><span id="local-6989586621679181885"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181885"><span class="hs-identifier hs-var">mN</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Int
</span><a href="Synthesis.Builder.html#bin2Node"><span class="hs-identifier hs-var">bin2Node</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;mul&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NMul"><span class="hs-identifier hs-var">NMul</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181884"><span class="hs-identifier hs-var">qN</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-443"></span><span>        </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;sub&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NSub"><span class="hs-identifier hs-var">NSub</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181885"><span class="hs-identifier hs-var">mN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>      </span><span class="annot"><span class="annottext">BinOperator
</span><a href="Syntax.html#Eq"><span class="hs-identifier hs-var">Eq</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;equal&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NEqual"><span class="hs-identifier hs-var">NEqual</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-445"></span><span>      </span><span class="annot"><span class="annottext">BinOperator
</span><a href="Syntax.html#Lt"><span class="hs-identifier hs-var">Lt</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;lthan&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NLThan"><span class="hs-identifier hs-var">NLThan</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-446"></span><span>      </span><span class="annot"><span class="annottext">BinOperator
</span><a href="Syntax.html#Gt"><span class="hs-identifier hs-var">Gt</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;gthan&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NGThan"><span class="hs-identifier hs-var">NGThan</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-447"></span><span>      </span><span class="annot"><span class="annottext">BinOperator
</span><a href="Syntax.html#And"><span class="hs-identifier hs-var">And</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;band&quot;</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NBand"><span class="hs-identifier hs-var">NBand</span></a></span><span>  </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-448"></span><span>      </span><span class="annot"><span class="annottext">BinOperator
</span><a href="Syntax.html#Or"><span class="hs-identifier hs-var">Or</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679181891"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181891"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Int
</span><a href="Synthesis.Builder.html#bin2Node"><span class="hs-identifier hs-var">bin2Node</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;add&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NAdd"><span class="hs-identifier hs-var">NAdd</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-449"></span><span>                </span><span id="local-6989586621679181892"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181892"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var">constI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-450"></span><span>                </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;gthan&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NGThan"><span class="hs-identifier hs-var">NGThan</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181891"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181892"><span class="hs-identifier hs-var">z</span></a></span><span>
</span><span id="line-451"></span><span>      </span><span class="annot"><span class="annottext">BinOperator
</span><a href="Syntax.html#Le"><span class="hs-identifier hs-var">Le</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679181894"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181894"><span class="hs-identifier hs-var">lt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;lthan&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NLThan"><span class="hs-identifier hs-var">NLThan</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-452"></span><span>                </span><span id="local-6989586621679181895"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181895"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;equal&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NEqual"><span class="hs-identifier hs-var">NEqual</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-453"></span><span>                </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#orP"><span class="hs-identifier hs-var">orP</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181894"><span class="hs-identifier hs-var">lt</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181895"><span class="hs-identifier hs-var">eq</span></a></span><span>
</span><span id="line-454"></span><span>      </span><span class="annot"><span class="annottext">BinOperator
</span><a href="Syntax.html#Ge"><span class="hs-identifier hs-var">Ge</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679181898"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181898"><span class="hs-identifier hs-var">gt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;gthan&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NGThan"><span class="hs-identifier hs-var">NGThan</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-455"></span><span>                </span><span id="local-6989586621679181899"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181899"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;equal&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NEqual"><span class="hs-identifier hs-var">NEqual</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-456"></span><span>                </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#orP"><span class="hs-identifier hs-var">orP</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181898"><span class="hs-identifier hs-var">gt</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181899"><span class="hs-identifier hs-var">eq</span></a></span><span>
</span><span id="line-457"></span><span>      </span><span class="annot"><span class="annottext">BinOperator
</span><a href="Syntax.html#Neq"><span class="hs-identifier hs-var">Neq</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679181901"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181901"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;equal&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NEqual"><span class="hs-identifier hs-var">NEqual</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181875"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181876"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-458"></span><span>                </span><span class="annot"><span class="annottext">Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#notP"><span class="hs-identifier hs-var">notP</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181901"><span class="hs-identifier hs-var">eq</span></a></span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span>  </span><span class="annot"><a href="Syntax.html#UnOp"><span class="hs-identifier hs-type">UnOp</span></a></span><span> </span><span id="local-6989586621679181904"><span class="annot"><span class="annottext">UnOperator
</span><a href="#local-6989586621679181904"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679181905"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181905"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-461"></span><span>    </span><span id="local-6989586621679181906"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181906"><span class="hs-identifier hs-var">pe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181905"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnOperator
</span><a href="#local-6989586621679181904"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-463"></span><span>      </span><span class="annot"><span class="annottext">UnOperator
</span><a href="Syntax.html#Neg"><span class="hs-identifier hs-var">Neg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679181908"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181908"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var">constI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;sub&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NSub"><span class="hs-identifier hs-var">NSub</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181908"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181906"><span class="hs-identifier hs-var">pe</span></a></span><span>
</span><span id="line-464"></span><span>      </span><span class="annot"><span class="annottext">UnOperator
</span><a href="Syntax.html#Not"><span class="hs-identifier hs-var">Not</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#notP"><span class="hs-identifier hs-var">notP</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181906"><span class="hs-identifier hs-var">pe</span></a></span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span>  </span><span class="annot"><a href="Syntax.html#Super"><span class="hs-identifier hs-type">Super</span></a></span><span> </span><span id="local-6989586621679181911"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181911"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span id="local-6989586621679181912"><span class="annot"><span class="annottext">SuperKind
</span><a href="#local-6989586621679181912"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621679181913"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181913"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span id="local-6989586621679181914"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181914"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-467"></span><span>    </span><span id="local-6989586621679181915"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181915"><span class="hs-identifier hs-var">pIn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; Expr
</span><a href="Syntax.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181913"><span class="hs-identifier hs-var">inp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>    </span><span id="local-6989586621679181916"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181916"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; [Port] -&gt; Build Int
</span><a href="Synthesis.Builder.html#naryNode"><span class="hs-identifier hs-var">naryNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181911"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><a href="Node.html#NSuper"><span class="hs-identifier hs-type">NSuper</span></a></span><span>
</span><span id="line-469"></span><span>             </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nName :: Ident
</span><a href="Node.html#nName"><span class="hs-identifier hs-var">nName</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-470"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">superNum :: Int
</span><a href="#local-6989586621679181917"><span class="hs-identifier hs-var">superNum</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-471"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">superOuts :: Int
</span><a href="#local-6989586621679181918"><span class="hs-identifier hs-var">superOuts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-472"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">superSpec :: Bool
</span><a href="#local-6989586621679181919"><span class="hs-identifier hs-var">superSpec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SuperKind
</span><a href="#local-6989586621679181912"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">SuperKind
</span><a href="Syntax.html#SuperParallel"><span class="hs-identifier hs-var">SuperParallel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SuperKind
</span><a href="Syntax.html#SuperSingle"><span class="hs-identifier hs-var">SuperSingle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-473"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">superImm :: Maybe Int
</span><a href="#local-6989586621679181922"><span class="hs-identifier hs-var">superImm</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-474"></span><span>             </span><span class="hs-special">}</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181915"><span class="hs-identifier hs-var">pIn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-475"></span><span>    </span><span class="annot"><span class="annottext">Ident -&gt; Binding -&gt; Build ()
</span><a href="Synthesis.Builder.html#insertB"><span class="hs-identifier hs-var">insertB</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181914"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port -&gt; Binding
</span><a href="Synthesis.Builder.html#BPort"><span class="hs-identifier hs-var">BPort</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181916"><span class="hs-identifier hs-var">nid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>    </span><span class="annot"><span class="annottext">Port -&gt; Build Port
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181916"><span class="hs-identifier hs-var">nid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="hs-comment">-- Declara&#231;&#245;es ----------------------------------------------------------</span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span class="annot"><span class="hs-comment">-- | Insert a function lambda into the environment.</span></span><span>
</span><span id="line-481"></span><span class="annot"><a href="Synthesis.Builder.html#goDecl"><span class="hs-identifier hs-type">goDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Decl"><span class="hs-identifier hs-type">Decl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span id="goDecl"><span class="annot"><span class="annottext">goDecl :: Decl -&gt; Build ()
</span><a href="Synthesis.Builder.html#goDecl"><span class="hs-identifier hs-var hs-var">goDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Syntax.html#FunDecl"><span class="hs-identifier hs-type">FunDecl</span></a></span><span> </span><span id="local-6989586621679181923"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181923"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679181924"><span class="annot"><span class="annottext">ActiveStack
</span><a href="#local-6989586621679181924"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679181925"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181925"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Binding -&gt; Build ()
</span><a href="Synthesis.Builder.html#insertB"><span class="hs-identifier hs-var">insertB</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181923"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActiveStack -&gt; Expr -&gt; Binding
</span><a href="Synthesis.Builder.html#BLam"><span class="hs-identifier hs-var">BLam</span></a></span><span> </span><span class="annot"><span class="annottext">ActiveStack
</span><a href="#local-6989586621679181924"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181925"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>
</span><span id="line-484"></span><span class="hs-comment">-- Aplica&#231;&#227;o n-&#225;ria -----------------------------------------------------</span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span class="annot"><span class="hs-comment">-- | Flatten nested applications into @(head, args)@.</span></span><span>
</span><span id="line-487"></span><span class="annot"><a href="Synthesis.Builder.html#flattenApp"><span class="hs-identifier hs-type">flattenApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Syntax.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Syntax.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span id="flattenApp"><span class="annot"><span class="annottext">flattenApp :: Expr -&gt; (Expr, [Expr])
</span><a href="Synthesis.Builder.html#flattenApp"><span class="hs-identifier hs-var hs-var">flattenApp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-489"></span><span>  </span><span class="annot"><a href="Syntax.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621679181926"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181926"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679181927"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181927"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-490"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679181928"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181928"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679181929"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679181929"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; (Expr, [Expr])
</span><a href="Synthesis.Builder.html#flattenApp"><span class="hs-identifier hs-var">flattenApp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181926"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-491"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181928"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679181929"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr] -&gt; [Expr] -&gt; [Expr]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181927"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>  </span><span id="local-6989586621679181930"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181930"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181930"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span class="annot"><span class="hs-comment">-- | Mark a function as active while executing an action, then restore.</span></span><span>
</span><span id="line-495"></span><span id="local-6989586621679181149"><span class="annot"><a href="Synthesis.Builder.html#withActive"><span class="hs-identifier hs-type">withActive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181149"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181149"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-496"></span><span id="withActive"><span class="annot"><span class="annottext">withActive :: forall a. Ident -&gt; Build a -&gt; Build a
</span><a href="Synthesis.Builder.html#withActive"><span class="hs-identifier hs-var hs-var">withActive</span></a></span></span><span> </span><span id="local-6989586621679181943"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181943"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679181944"><span class="annot"><span class="annottext">Build a
</span><a href="#local-6989586621679181944"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique a -&gt; Build a
forall a. StateT BuildS Unique a -&gt; Build a
</span><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BuildS Unique a -&gt; Build a)
-&gt; StateT BuildS Unique a -&gt; Build a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-497"></span><span>  </span><span id="local-6989586621679181945"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181945"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique BuildS
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-498"></span><span>  </span><span class="annot"><span class="annottext">BuildS -&gt; StateT BuildS Unique ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181945"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#bsActive"><span class="hs-identifier hs-var">bsActive</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181943"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="Synthesis.Builder.html#bsActive"><span class="hs-identifier hs-var">bsActive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181945"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-499"></span><span>  </span><span id="local-6989586621679181946"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679181946"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Build a -&gt; StateT BuildS Unique a
forall a. Build a -&gt; StateT BuildS Unique a
</span><a href="Synthesis.Builder.html#unBuild"><span class="hs-identifier hs-var">unBuild</span></a></span><span> </span><span class="annot"><span class="annottext">Build a
</span><a href="#local-6989586621679181944"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-500"></span><span>  </span><span id="local-6989586621679181947"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181947"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique BuildS
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-501"></span><span>  </span><span class="annot"><span class="annottext">BuildS -&gt; StateT BuildS Unique ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181947"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#bsActive"><span class="hs-identifier hs-var">bsActive</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">tail</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Synthesis.Builder.html#bsActive"><span class="hs-identifier hs-var">bsActive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679181947"><span class="hs-identifier hs-type">s'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-502"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; StateT BuildS Unique a
forall a. a -&gt; StateT BuildS Unique a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679181946"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span class="hs-comment">-- taskId determin&#237;stico</span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span class="annot"><span class="hs-comment">-- | Deterministic task identifier derived from the function name.</span></span><span>
</span><span id="line-507"></span><span class="annot"><a href="Synthesis.Builder.html#funTaskId"><span class="hs-identifier hs-type">funTaskId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-508"></span><span id="funTaskId"><span class="annot"><span class="annottext">funTaskId :: Ident -&gt; Int
</span><a href="Synthesis.Builder.html#funTaskId"><span class="hs-identifier hs-var hs-var">funTaskId</span></a></span></span><span> </span><span id="local-6989586621679181950"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181950"><span class="hs-identifier hs-var">ident</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Char -&gt; Int) -&gt; Int -&gt; Ident -&gt; Int
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679181952"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181952"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679181953"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679181953"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181952"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">131</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679181953"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; Ident
forall a. Show a =&gt; a -&gt; Ident
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181950"><span class="hs-identifier hs-var">ident</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span class="hs-comment">-- n&#243; de argumento formal</span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="annot"><span class="hs-comment">-- | Ensure the formal argument node @fun#i@ exists and return its output port.</span></span><span>
</span><span id="line-513"></span><span class="annot"><a href="Synthesis.Builder.html#argNode"><span class="hs-identifier hs-type">argNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-514"></span><span id="argNode"><span class="annot"><span class="annottext">argNode :: Ident -&gt; Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#argNode"><span class="hs-identifier hs-var hs-var">argNode</span></a></span></span><span> </span><span id="local-6989586621679181957"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181957"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621679181958"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181958"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique Port -&gt; Build Port
forall a. StateT BuildS Unique a -&gt; Build a
</span><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-var">Build</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT BuildS Unique Port -&gt; Build Port)
-&gt; StateT BuildS Unique Port -&gt; Build Port
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-515"></span><span>  </span><span id="local-6989586621679181959"><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181959"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT BuildS Unique BuildS
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-516"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679181961"><span class="annot"><span class="annottext">nm :: Ident
</span><a href="#local-6989586621679181961"><span class="hs-identifier hs-var hs-var">nm</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181957"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Ident -&gt; Ident
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;#&quot;</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Ident -&gt; Ident
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ident
forall a. Show a =&gt; a -&gt; Ident
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181958"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-517"></span><span>      </span><span id="local-6989586621679181964"><span class="annot"><span class="annottext">found :: [Int]
</span><a href="#local-6989586621679181964"><span class="hs-identifier hs-var hs-var">found</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181965"><span class="hs-identifier hs-var">nid</span></a></span><span>
</span><span id="line-518"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679181965"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181965"><span class="hs-identifier hs-var">nid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679181966"><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181966"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Int DNode -&gt; [(Int, DNode)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFG -&gt; Map Int DNode
forall n. DGraph n -&gt; Map Int n
</span><a href="Types.html#dgNodes"><span class="hs-identifier hs-var">dgNodes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildS -&gt; DFG
</span><a href="Synthesis.Builder.html#bsGraph"><span class="hs-identifier hs-var">bsGraph</span></a></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181959"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679181966"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-520"></span><span>                  </span><span class="annot"><a href="Node.html#NArg"><span class="hs-identifier hs-type">NArg</span></a></span><span> </span><span id="local-6989586621679181967"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181967"><span class="hs-identifier hs-var">nm'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181967"><span class="hs-identifier hs-var">nm'</span></a></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Ident -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181961"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-521"></span><span>                  </span><span class="annot"><span class="annottext">DNode
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-522"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-523"></span><span>  </span><span id="local-6989586621679181968"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181968"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679181964"><span class="hs-identifier hs-var">found</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-524"></span><span>           </span><span class="hs-special">(</span><span id="local-6989586621679181969"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181969"><span class="hs-identifier hs-var">h</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Int]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; StateT BuildS Unique Int
forall a. a -&gt; StateT BuildS Unique a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181969"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-525"></span><span>           </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-526"></span><span>             </span><span id="local-6989586621679181970"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181970"><span class="hs-identifier hs-var">nid'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Unique Int -&gt; StateT BuildS Unique Int
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; StateT BuildS m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">Unique Int
forall (m :: * -&gt; *). MonadUnique m =&gt; m Int
</span><a href="Unique.html#freshId"><span class="hs-identifier hs-var">freshId</span></a></span><span>
</span><span id="line-527"></span><span>             </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679181971"><span class="annot"><span class="annottext">g' :: DFG
</span><a href="#local-6989586621679181971"><span class="hs-identifier hs-var hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; DNode -&gt; DFG -&gt; DFG
forall n. Int -&gt; n -&gt; DGraph n -&gt; DGraph n
</span><a href="Types.html#addNode"><span class="hs-identifier hs-var">addNode</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181970"><span class="hs-identifier hs-var">nid'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NArg"><span class="hs-identifier hs-var">NArg</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181961"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildS -&gt; DFG
</span><a href="Synthesis.Builder.html#bsGraph"><span class="hs-identifier hs-var">bsGraph</span></a></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181959"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span>             </span><span class="annot"><span class="annottext">BuildS -&gt; StateT BuildS Unique ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">BuildS
</span><a href="#local-6989586621679181959"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#bsGraph"><span class="hs-identifier hs-var">bsGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679181971"><span class="hs-identifier hs-type">g'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-529"></span><span>             </span><span class="annot"><span class="annottext">Int -&gt; StateT BuildS Unique Int
forall a. a -&gt; StateT BuildS Unique a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181970"><span class="hs-identifier hs-var">nid'</span></a></span><span>
</span><span id="line-530"></span><span>  </span><span class="annot"><span class="annottext">Port -&gt; StateT BuildS Unique Port
forall a. a -&gt; StateT BuildS Unique a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181968"><span class="hs-identifier hs-var">nid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span class="hs-comment">-- formal + alias para o real</span><span>
</span><span id="line-533"></span><span>
</span><span id="line-534"></span><span class="annot"><span class="hs-comment">-- | Bind a formal parameter to the actual input port, wiring aliases.</span></span><span>
</span><span id="line-535"></span><span class="annot"><a href="Synthesis.Builder.html#bindFormal"><span class="hs-identifier hs-type">bindFormal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-536"></span><span id="bindFormal"><span class="annot"><span class="annottext">bindFormal :: Ident -&gt; Int -&gt; Ident -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#bindFormal"><span class="hs-identifier hs-var hs-var">bindFormal</span></a></span></span><span> </span><span id="local-6989586621679181973"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181973"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621679181974"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181974"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679181975"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181975"><span class="hs-identifier hs-var">formal</span></a></span></span><span> </span><span id="local-6989586621679181976"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181976"><span class="hs-identifier hs-var">actual</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-537"></span><span>  </span><span id="local-6989586621679181977"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181977"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#argNode"><span class="hs-identifier hs-var">argNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181973"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181974"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-538"></span><span>  </span><span class="annot"><span class="annottext">Ident -&gt; Binding -&gt; Build ()
</span><a href="Synthesis.Builder.html#insertB"><span class="hs-identifier hs-var">insertB</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181975"><span class="hs-identifier hs-var">formal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port -&gt; Binding
</span><a href="Synthesis.Builder.html#BPort"><span class="hs-identifier hs-var">BPort</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181977"><span class="hs-identifier hs-var">ap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181977"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-540"></span><span>    </span><span class="annot"><a href="Port.html#InstPort"><span class="hs-identifier hs-type">InstPort</span></a></span><span> </span><span id="local-6989586621679181978"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181978"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connectPlus"><span class="hs-identifier hs-var">connectPlus</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181976"><span class="hs-identifier hs-var">actual</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181978"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>    </span><span class="annot"><span class="annottext">Port
</span><span class="hs-identifier">_</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Build ()
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span class="annot"><span class="hs-comment">-- | Apply a function or lambda to argument expressions.</span></span><span>
</span><span id="line-544"></span><span class="annot"><a href="Synthesis.Builder.html#goApp"><span class="hs-identifier hs-type">goApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Syntax.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-545"></span><span id="goApp"><span class="annot"><span class="annottext">goApp :: Expr -&gt; [Expr] -&gt; Build Port
</span><a href="Synthesis.Builder.html#goApp"><span class="hs-identifier hs-var hs-var">goApp</span></a></span></span><span> </span><span id="local-6989586621679181979"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181979"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621679181980"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679181980"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181979"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-546"></span><span>  </span><span class="annot"><a href="Syntax.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621679181981"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181981"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-547"></span><span>    </span><span id="local-6989586621679181982"><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679181982"><span class="hs-identifier hs-var">argv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Build Port) -&gt; [Expr] -&gt; Build [Port]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679181980"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-548"></span><span>    </span><span id="local-6989586621679181983"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181983"><span class="hs-identifier hs-var">anyFloat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">or</span></span><span> </span><span class="annot"><span class="annottext">([Bool] -&gt; Bool) -&gt; Build [Bool] -&gt; Build Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Port -&gt; Build Bool) -&gt; [Port] -&gt; Build [Bool]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Bool
</span><a href="Synthesis.Builder.html#portIsFloat"><span class="hs-identifier hs-var">portIsFloat</span></a></span><span> </span><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679181982"><span class="hs-identifier hs-var">argv</span></a></span><span>
</span><span id="line-549"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Build () -&gt; Build ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679181983"><span class="hs-identifier hs-var">anyFloat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; Build ()
</span><a href="Synthesis.Builder.html#markFloatFun"><span class="hs-identifier hs-var">markFloatFun</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181981"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span>    </span><span class="annot"><span class="annottext">Ident -&gt; Build (Maybe Binding)
</span><a href="Synthesis.Builder.html#lookupB"><span class="hs-identifier hs-var">lookupB</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181981"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Build (Maybe Binding) -&gt; (Maybe Binding -&gt; Build ()) -&gt; Build ()
forall a b. Build a -&gt; (a -&gt; Build b) -&gt; Build b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-552"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Synthesis.Builder.html#BLam"><span class="hs-identifier hs-type">BLam</span></a></span><span> </span><span id="local-6989586621679181986"><span class="annot"><span class="annottext">ActiveStack
</span><a href="#local-6989586621679181986"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679181987"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181987"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; ActiveStack -&gt; Expr -&gt; Build ()
</span><a href="Synthesis.Builder.html#ensureBuilt"><span class="hs-identifier hs-var">ensureBuilt</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181981"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ActiveStack
</span><a href="#local-6989586621679181986"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181987"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-553"></span><span>      </span><span class="annot"><span class="annottext">Maybe Binding
</span><span class="hs-identifier">_</span></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Build ()
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679181988"><span class="annot"><span class="annottext">tid :: Int
</span><a href="#local-6989586621679181988"><span class="hs-identifier hs-var hs-var">tid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Int
</span><a href="Synthesis.Builder.html#funTaskId"><span class="hs-identifier hs-var">funTaskId</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181981"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-556"></span><span>    </span><span id="local-6989586621679181989"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181989"><span class="hs-identifier hs-var">cg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181981"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NCallGroup"><span class="hs-identifier hs-var">NCallGroup</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181981"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679181990"><span class="annot"><span class="annottext">tag :: Port
</span><a href="#local-6989586621679181990"><span class="hs-identifier hs-var hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181989"><span class="hs-identifier hs-var">cg</span></a></span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span>    </span><span class="annot"><span class="annottext">[(Integer, Port)] -&gt; ((Integer, Port) -&gt; Build ()) -&gt; Build ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Integer] -&gt; [Port] -&gt; [(Integer, Port)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679181982"><span class="hs-identifier hs-var">argv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((Integer, Port) -&gt; Build ()) -&gt; Build ())
-&gt; ((Integer, Port) -&gt; Build ()) -&gt; Build ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679181991"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679181991"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679181992"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181992"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-560"></span><span>      </span><span id="local-6989586621679181993"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181993"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181981"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Ident -&gt; Ident
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;#&quot;</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Ident -&gt; Ident
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Ident
forall a. Show a =&gt; a -&gt; Ident
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679181991"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; Int -&gt; DNode
</span><a href="Node.html#NCallSnd"><span class="hs-identifier hs-var">NCallSnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181981"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Ident -&gt; Ident
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;#&quot;</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Ident -&gt; Ident
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Ident
forall a. Show a =&gt; a -&gt; Ident
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679181991"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181988"><span class="hs-identifier hs-var">tid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>      </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connectPlus"><span class="hs-identifier hs-var">connectPlus</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181992"><span class="hs-identifier hs-var">a</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181993"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>      </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connectPlus"><span class="hs-identifier hs-var">connectPlus</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181990"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181993"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;1&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span>    </span><span id="local-6989586621679181994"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181994"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181981"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; Int -&gt; DNode
</span><a href="Node.html#NRetSnd"><span class="hs-identifier hs-var">NRetSnd</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181981"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181988"><span class="hs-identifier hs-var">tid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>    </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connectPlus"><span class="hs-identifier hs-var">connectPlus</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679181990"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181994"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;1&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>    </span><span class="annot"><span class="annottext">Port -&gt; Build Port
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181994"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span>  </span><span class="annot"><a href="Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span id="local-6989586621679181995"><span class="annot"><span class="annottext">ActiveStack
</span><a href="#local-6989586621679181995"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679181996"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181996"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-569"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679181997"><span class="annot"><span class="annottext">fname :: Ident
</span><a href="#local-6989586621679181997"><span class="hs-identifier hs-var hs-var">fname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;lambda&quot;</span></span><span>
</span><span id="line-570"></span><span>        </span><span id="local-6989586621679181998"><span class="annot"><span class="annottext">tid :: Int
</span><a href="#local-6989586621679181998"><span class="hs-identifier hs-var hs-var">tid</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Int
</span><a href="Synthesis.Builder.html#funTaskId"><span class="hs-identifier hs-var">funTaskId</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181997"><span class="hs-identifier hs-var">fname</span></a></span><span>
</span><span id="line-571"></span><span>    </span><span id="local-6989586621679181999"><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679181999"><span class="hs-identifier hs-var">argv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Build Port) -&gt; [Expr] -&gt; Build [Port]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679181980"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-572"></span><span>    </span><span id="local-6989586621679182000"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182000"><span class="hs-identifier hs-var">cg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181997"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NCallGroup"><span class="hs-identifier hs-var">NCallGroup</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181997"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679182001"><span class="annot"><span class="annottext">tag :: Port
</span><a href="#local-6989586621679182001"><span class="hs-identifier hs-var hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182000"><span class="hs-identifier hs-var">cg</span></a></span><span>
</span><span id="line-574"></span><span>    </span><span class="annot"><span class="annottext">[(Integer, Port)] -&gt; ((Integer, Port) -&gt; Build ()) -&gt; Build ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Integer] -&gt; [Port] -&gt; [(Integer, Port)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679181999"><span class="hs-identifier hs-var">argv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((Integer, Port) -&gt; Build ()) -&gt; Build ())
-&gt; ((Integer, Port) -&gt; Build ()) -&gt; Build ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679182002"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679182002"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679182003"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182003"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-575"></span><span>      </span><span id="local-6989586621679182004"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182004"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181997"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Ident -&gt; Ident
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;#&quot;</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Ident -&gt; Ident
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Ident
forall a. Show a =&gt; a -&gt; Ident
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679182002"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; Int -&gt; DNode
</span><a href="Node.html#NCallSnd"><span class="hs-identifier hs-var">NCallSnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181997"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Ident -&gt; Ident
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;#&quot;</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Ident -&gt; Ident
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Ident
forall a. Show a =&gt; a -&gt; Ident
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679182002"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181998"><span class="hs-identifier hs-var">tid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>      </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connectPlus"><span class="hs-identifier hs-var">connectPlus</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182003"><span class="hs-identifier hs-var">a</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182004"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>      </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connectPlus"><span class="hs-identifier hs-var">connectPlus</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182001"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182004"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;1&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span>    </span><span id="local-6989586621679182005"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182005"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181997"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; Int -&gt; DNode
</span><a href="Node.html#NRetSnd"><span class="hs-identifier hs-var">NRetSnd</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181997"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679181998"><span class="hs-identifier hs-var">tid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>    </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connectPlus"><span class="hs-identifier hs-var">connectPlus</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182001"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182005"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;1&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span>    </span><span id="local-6989586621679182006"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182006"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Build Port -&gt; Build Port
forall a. Build a -&gt; Build a
</span><a href="Synthesis.Builder.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Build Port -&gt; Build Port) -&gt; Build Port -&gt; Build Port
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-581"></span><span>             </span><span class="annot"><span class="annottext">[(Int, Ident, Port)]
-&gt; ((Int, Ident, Port) -&gt; Build ()) -&gt; Build ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; ActiveStack -&gt; [Port] -&gt; [(Int, Ident, Port)]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><span class="hs-identifier hs-var">zip3</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ActiveStack
</span><a href="#local-6989586621679181995"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679181999"><span class="hs-identifier hs-var">argv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((Int, Ident, Port) -&gt; Build ()) -&gt; Build ())
-&gt; ((Int, Ident, Port) -&gt; Build ()) -&gt; Build ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679182008"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182008"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679182009"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679182009"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679182010"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182010"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Int -&gt; Ident -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#bindFormal"><span class="hs-identifier hs-var">bindFormal</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679181997"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182008"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679182009"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182010"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-582"></span><span>             </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679181996"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-583"></span><span>    </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connectPlus"><span class="hs-identifier hs-var">connectPlus</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182006"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182005"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span>    </span><span class="annot"><span class="annottext">Port -&gt; Build Port
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182006"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-585"></span><span>
</span><span id="line-586"></span><span>  </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-587"></span><span>    </span><span class="annot"><span class="annottext">[Port]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Build Port) -&gt; [Expr] -&gt; Build [Port]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679181980"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-588"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679181980"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-589"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var">constI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-590"></span><span>      </span><span class="annot"><span class="annottext">[Expr]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Expr] -&gt; Expr
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679181980"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-591"></span><span>
</span><span id="line-592"></span><span class="hs-comment">-- Literais -------------------------------------------------------------</span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span class="annot"><span class="hs-comment">-- | Build a constant for a 'Literal'.</span></span><span>
</span><span id="line-595"></span><span class="annot"><a href="Synthesis.Builder.html#litNode"><span class="hs-identifier hs-type">litNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-596"></span><span id="litNode"><span class="annot"><span class="annottext">litNode :: Literal -&gt; Build Port
</span><a href="Synthesis.Builder.html#litNode"><span class="hs-identifier hs-var hs-var">litNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-597"></span><span>  </span><span class="annot"><a href="Syntax.html#LInt"><span class="hs-identifier hs-type">LInt</span></a></span><span> </span><span id="local-6989586621679182013"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182013"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var">constI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182013"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-598"></span><span>  </span><span class="annot"><a href="Syntax.html#LFloat"><span class="hs-identifier hs-type">LFloat</span></a></span><span> </span><span id="local-6989586621679182015"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182015"><span class="hs-identifier hs-var">d</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;fconst&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; Float -&gt; DNode
</span><a href="Node.html#NConstF"><span class="hs-identifier hs-var">NConstF</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Float
forall a b. (Real a, Fractional b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">realToFrac</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679182015"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Build Int -&gt; (Int -&gt; Build Port) -&gt; Build Port
forall a b. Build a -&gt; (a -&gt; Build b) -&gt; Build b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679182016"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182016"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182016"><span class="hs-identifier hs-var">nid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>  </span><span class="annot"><a href="Syntax.html#LChar"><span class="hs-identifier hs-type">LChar</span></a></span><span> </span><span id="local-6989586621679182018"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679182018"><span class="hs-identifier hs-var">c</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var">constI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679182018"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>  </span><span class="annot"><a href="Syntax.html#LString"><span class="hs-identifier hs-type">LString</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var">constI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-601"></span><span>  </span><span class="annot"><a href="Syntax.html#LBool"><span class="hs-identifier hs-type">LBool</span></a></span><span> </span><span id="local-6989586621679182021"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679182021"><span class="hs-identifier hs-var">b</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var">constI</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679182021"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>
</span><span id="line-603"></span><span class="hs-comment">-- Helpers --------------------------------------------------------------</span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span class="annot"><span class="hs-comment">-- | Convenience for a binary operation node, returning its output port.</span></span><span>
</span><span id="line-606"></span><span class="annot"><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-type">bin2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Node.html#DNode"><span class="hs-identifier hs-type">DNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-607"></span><span id="bin2"><span class="annot"><span class="annottext">bin2 :: Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var hs-var">bin2</span></a></span></span><span> </span><span id="local-6989586621679182022"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679182022"><span class="hs-identifier hs-var">_lbl</span></a></span></span><span> </span><span id="local-6989586621679182023"><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679182023"><span class="hs-identifier hs-var">nd</span></a></span></span><span> </span><span id="local-6989586621679182024"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182024"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679182025"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182025"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Port) -&gt; Build Int -&gt; Build Port
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Int
</span><a href="Synthesis.Builder.html#bin2Node"><span class="hs-identifier hs-var">bin2Node</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;b2&quot;</span></span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679182023"><span class="hs-identifier hs-var">nd</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182024"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182025"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-608"></span><span>
</span><span id="line-609"></span><span class="annot"><span class="hs-comment">-- | Build a binary operation node, returning its 'NodeId'.</span></span><span>
</span><span id="line-610"></span><span class="annot"><a href="Synthesis.Builder.html#bin2Node"><span class="hs-identifier hs-type">bin2Node</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Node.html#DNode"><span class="hs-identifier hs-type">DNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Types.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span>
</span><span id="line-611"></span><span id="bin2Node"><span class="annot"><span class="annottext">bin2Node :: Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Int
</span><a href="Synthesis.Builder.html#bin2Node"><span class="hs-identifier hs-var hs-var">bin2Node</span></a></span></span><span> </span><span id="local-6989586621679182026"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679182026"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621679182027"><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679182027"><span class="hs-identifier hs-var">nd</span></a></span></span><span> </span><span id="local-6989586621679182028"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182028"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679182029"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182029"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-612"></span><span>  </span><span id="local-6989586621679182030"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182030"><span class="hs-identifier hs-var">nid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679182026"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">DNode
</span><a href="#local-6989586621679182027"><span class="hs-identifier hs-var">nd</span></a></span><span>
</span><span id="line-613"></span><span>  </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connectPlus"><span class="hs-identifier hs-var">connectPlus</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182028"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182030"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>  </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connectPlus"><span class="hs-identifier hs-var">connectPlus</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182029"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182030"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;1&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-615"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Build Int
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182030"><span class="hs-identifier hs-var">nid</span></a></span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span class="annot"><span class="hs-comment">-- | Logical NOT implemented as equality with zero.</span></span><span>
</span><span id="line-618"></span><span class="annot"><a href="Synthesis.Builder.html#notP"><span class="hs-identifier hs-type">notP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-619"></span><span id="notP"><span class="annot"><span class="annottext">notP :: Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#notP"><span class="hs-identifier hs-var hs-var">notP</span></a></span></span><span> </span><span id="local-6989586621679182031"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182031"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679182032"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182032"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var">constI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;equal&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NEqual"><span class="hs-identifier hs-var">NEqual</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182031"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182032"><span class="hs-identifier hs-var">z</span></a></span><span>
</span><span id="line-620"></span><span>
</span><span id="line-621"></span><span class="annot"><span class="hs-comment">-- | Logical OR implemented as @(a+b) &gt; 0@.</span></span><span>
</span><span id="line-622"></span><span class="annot"><a href="Synthesis.Builder.html#orP"><span class="hs-identifier hs-type">orP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-623"></span><span id="orP"><span class="annot"><span class="annottext">orP :: Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#orP"><span class="hs-identifier hs-var hs-var">orP</span></a></span></span><span> </span><span id="local-6989586621679182033"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182033"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679182034"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182034"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679182035"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182035"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Int
</span><a href="Synthesis.Builder.html#bin2Node"><span class="hs-identifier hs-var">bin2Node</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;add&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NAdd"><span class="hs-identifier hs-var">NAdd</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182033"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182034"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-624"></span><span>             </span><span id="local-6989586621679182036"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182036"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var">constI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-625"></span><span>             </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;gthan&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NGThan"><span class="hs-identifier hs-var">NGThan</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Port
</span><a href="Synthesis.Builder.html#out0"><span class="hs-identifier hs-var">out0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182035"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182036"><span class="hs-identifier hs-var">z</span></a></span><span>
</span><span id="line-626"></span><span>
</span><span id="line-627"></span><span class="annot"><span class="hs-comment">-- | Logical AND using bitwise-and node.</span></span><span>
</span><span id="line-628"></span><span class="annot"><a href="Synthesis.Builder.html#andP"><span class="hs-identifier hs-type">andP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-629"></span><span id="andP"><span class="annot"><span class="annottext">andP :: Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#andP"><span class="hs-identifier hs-var hs-var">andP</span></a></span></span><span> </span><span id="local-6989586621679182038"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182038"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679182039"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182039"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;band&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NBand"><span class="hs-identifier hs-var">NBand</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182038"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182039"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span class="annot"><span class="hs-comment">-- | Boolean constants (1/0).</span></span><span>
</span><span id="line-632"></span><span class="annot"><a href="Synthesis.Builder.html#trueP"><span class="hs-identifier hs-type">trueP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#falseP"><span class="hs-identifier hs-type">falseP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-633"></span><span id="trueP"><span class="annot"><span class="annottext">trueP :: Build Port
</span><a href="Synthesis.Builder.html#trueP"><span class="hs-identifier hs-var hs-var">trueP</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var">constI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-634"></span><span id="falseP"><span class="annot"><span class="annottext">falseP :: Build Port
</span><a href="Synthesis.Builder.html#falseP"><span class="hs-identifier hs-var hs-var">falseP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Build Port
</span><a href="Synthesis.Builder.html#constI"><span class="hs-identifier hs-var">constI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-635"></span><span>
</span><span id="line-636"></span><span class="hs-comment">-- CASE / Pattern matching ----------------------------------------------</span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span class="annot"><span class="hs-comment">-- | Compile a @case@ by building guards and steering results.</span></span><span>
</span><span id="line-639"></span><span class="annot"><a href="Synthesis.Builder.html#compileCase"><span class="hs-identifier hs-type">compileCase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Syntax.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Syntax.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-640"></span><span id="compileCase"><span class="annot"><span class="annottext">compileCase :: Expr -&gt; [(Pattern, Expr)] -&gt; Build Port
</span><a href="Synthesis.Builder.html#compileCase"><span class="hs-identifier hs-var hs-var">compileCase</span></a></span></span><span> </span><span id="local-6989586621679182042"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679182042"><span class="hs-identifier hs-var">scr</span></a></span></span><span> </span><span id="local-6989586621679182043"><span class="annot"><span class="annottext">[(Pattern, Expr)]
</span><a href="#local-6989586621679182043"><span class="hs-identifier hs-var">alts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-641"></span><span>  </span><span id="local-6989586621679182044"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182044"><span class="hs-identifier hs-var">pscr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679182042"><span class="hs-identifier hs-var">scr</span></a></span><span>
</span><span id="line-642"></span><span>  </span><span id="local-6989586621679182045"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182045"><span class="hs-identifier hs-var">taken0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Build Port
</span><a href="Synthesis.Builder.html#falseP"><span class="hs-identifier hs-var">falseP</span></a></span><span>
</span><span id="line-643"></span><span>  </span><span id="local-6989586621679182046"><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679182046"><span class="hs-identifier hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; [(Pattern, Expr)] -&gt; [Port] -&gt; Build [Port]
</span><a href="#local-6989586621679182047"><span class="hs-identifier hs-var">goAlts</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182044"><span class="hs-identifier hs-var">pscr</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182045"><span class="hs-identifier hs-var">taken0</span></a></span><span> </span><span class="annot"><span class="annottext">[(Pattern, Expr)]
</span><a href="#local-6989586621679182043"><span class="hs-identifier hs-var">alts</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-644"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679182046"><span class="hs-identifier hs-var">outs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-645"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Build Port
</span><a href="Synthesis.Builder.html#falseP"><span class="hs-identifier hs-var">falseP</span></a></span><span>
</span><span id="line-646"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679182048"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182048"><span class="hs-identifier hs-var">h</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679182049"><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679182049"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Port -&gt; [Port] -&gt; Build ()
</span><a href="Synthesis.Builder.html#registerAlias"><span class="hs-identifier hs-var">registerAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182048"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679182049"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">Build () -&gt; Build Port -&gt; Build Port
forall a b. Build a -&gt; Build b -&gt; Build b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182048"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-647"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-648"></span><span>    </span><span class="hs-comment">-- | Build each alternative with its predicate and guard.</span><span>
</span><span id="line-649"></span><span>    </span><span id="local-6989586621679182047"><span class="annot"><span class="annottext">goAlts :: Port -&gt; Port -&gt; [(Pattern, Expr)] -&gt; [Port] -&gt; Build [Port]
</span><a href="#local-6989586621679182047"><span class="hs-identifier hs-var hs-var">goAlts</span></a></span></span><span> </span><span class="annot"><span class="annottext">Port
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">Port
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span>            </span><span id="local-6989586621679182062"><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679182062"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Port] -&gt; Build [Port]
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Port] -&gt; [Port]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679182062"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-650"></span><span>    </span><span class="annot"><a href="#local-6989586621679182047"><span class="hs-identifier hs-var">goAlts</span></a></span><span> </span><span id="local-6989586621679182064"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182064"><span class="hs-identifier hs-var">pscr</span></a></span></span><span> </span><span id="local-6989586621679182065"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182065"><span class="hs-identifier hs-var">taken</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679182066"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679182066"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679182067"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679182067"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679182068"><span class="annot"><span class="annottext">[(Pattern, Expr)]
</span><a href="#local-6989586621679182068"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679182069"><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679182069"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-651"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679182070"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182070"><span class="hs-identifier hs-var">pPred</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679182071"><span class="annot"><span class="annottext">[(Ident, Port)]
</span><a href="#local-6989586621679182071"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Pattern -&gt; Build (Port, [(Ident, Port)])
</span><a href="Synthesis.Builder.html#patPred"><span class="hs-identifier hs-var">patPred</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182064"><span class="hs-identifier hs-var">pscr</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679182066"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-652"></span><span>      </span><span id="local-6989586621679182073"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182073"><span class="hs-identifier hs-var">ntaken</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#notP"><span class="hs-identifier hs-var">notP</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182065"><span class="hs-identifier hs-var">taken</span></a></span><span>
</span><span id="line-653"></span><span>      </span><span id="local-6989586621679182074"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182074"><span class="hs-identifier hs-var">guardi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#andP"><span class="hs-identifier hs-var">andP</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182070"><span class="hs-identifier hs-var">pPred</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182073"><span class="hs-identifier hs-var">ntaken</span></a></span><span>
</span><span id="line-654"></span><span>      </span><span id="local-6989586621679182075"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182075"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Build Port -&gt; Build Port
forall a. Build a -&gt; Build a
</span><a href="Synthesis.Builder.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Build Port -&gt; Build Port) -&gt; Build Port -&gt; Build Port
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-655"></span><span>               </span><span class="annot"><span class="annottext">((Ident, Port) -&gt; Build ()) -&gt; [(Ident, Port)] -&gt; Build ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679182076"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679182076"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679182077"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182077"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; Binding -&gt; Build ()
</span><a href="Synthesis.Builder.html#insertB"><span class="hs-identifier hs-var">insertB</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679182076"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port -&gt; Binding
</span><a href="Synthesis.Builder.html#BPort"><span class="hs-identifier hs-var">BPort</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182077"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Ident, Port)]
</span><a href="#local-6989586621679182071"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-656"></span><span>               </span><span class="annot"><span class="annottext">Expr -&gt; Build Port
</span><a href="Synthesis.Builder.html#goExpr"><span class="hs-identifier hs-var">goExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679182067"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-657"></span><span>      </span><span id="local-6989586621679182078"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182078"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Build Int
</span><a href="Synthesis.Builder.html#newNode"><span class="hs-identifier hs-var">newNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;steer&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NSteer"><span class="hs-identifier hs-var">NSteer</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span>      </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connect"><span class="hs-identifier hs-var">connect</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182075"><span class="hs-identifier hs-var">val</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182078"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>      </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build ()
</span><a href="Synthesis.Builder.html#connect"><span class="hs-identifier hs-var">connect</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182074"><span class="hs-identifier hs-var">guardi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#InstPort"><span class="hs-identifier hs-var">InstPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182078"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;1&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-660"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679182079"><span class="annot"><span class="annottext">out :: Port
</span><a href="#local-6989586621679182079"><span class="hs-identifier hs-var hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ident -&gt; Port
</span><a href="Port.html#SteerPort"><span class="hs-identifier hs-var">SteerPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679182078"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;t&quot;</span></span><span>
</span><span id="line-661"></span><span>      </span><span id="local-6989586621679182080"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182080"><span class="hs-identifier hs-var">taken'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#orP"><span class="hs-identifier hs-var">orP</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182065"><span class="hs-identifier hs-var">taken</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182070"><span class="hs-identifier hs-var">pPred</span></a></span><span>
</span><span id="line-662"></span><span>      </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; [(Pattern, Expr)] -&gt; [Port] -&gt; Build [Port]
</span><a href="#local-6989586621679182047"><span class="hs-identifier hs-var">goAlts</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182064"><span class="hs-identifier hs-var">pscr</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182080"><span class="hs-identifier hs-var">taken'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Pattern, Expr)]
</span><a href="#local-6989586621679182068"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182079"><span class="hs-identifier hs-var">out</span></a></span><span class="annot"><span class="annottext">Port -&gt; [Port] -&gt; [Port]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Port]
</span><a href="#local-6989586621679182069"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span class="annot"><span class="hs-comment">-- | Build the predicate and bindings for matching a 'Pattern' against a scrutinee port.</span></span><span>
</span><span id="line-665"></span><span class="annot"><a href="Synthesis.Builder.html#patPred"><span class="hs-identifier hs-type">patPred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Syntax.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-666"></span><span id="patPred"><span class="annot"><span class="annottext">patPred :: Port -&gt; Pattern -&gt; Build (Port, [(Ident, Port)])
</span><a href="Synthesis.Builder.html#patPred"><span class="hs-identifier hs-var hs-var">patPred</span></a></span></span><span> </span><span id="local-6989586621679182081"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182081"><span class="hs-identifier hs-var">scr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-667"></span><span>  </span><span class="annot"><a href="Syntax.html#PTuple"><span class="hs-identifier hs-type">PTuple</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679182083"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679182083"><span class="hs-identifier hs-var">p1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679182084"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679182084"><span class="hs-identifier hs-var">p2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-668"></span><span>    </span><span id="local-6989586621679182085"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182085"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#fstDec"><span class="hs-identifier hs-var">fstDec</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182081"><span class="hs-identifier hs-var">scr</span></a></span><span class="hs-special">;</span><span> </span><span id="local-6989586621679182086"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182086"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#sndDec"><span class="hs-identifier hs-var">sndDec</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182081"><span class="hs-identifier hs-var">scr</span></a></span><span class="hs-special">;</span><span> </span><span id="local-6989586621679182087"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182087"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Build Port
</span><a href="Synthesis.Builder.html#trueP"><span class="hs-identifier hs-var">trueP</span></a></span><span>
</span><span id="line-669"></span><span>    </span><span class="annot"><span class="annottext">(Port, [(Ident, Port)]) -&gt; Build (Port, [(Ident, Port)])
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182087"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; Port -&gt; [(Ident, Port)]
</span><a href="Synthesis.Builder.html#bindIfVar"><span class="hs-identifier hs-var">bindIfVar</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679182083"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182085"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[(Ident, Port)] -&gt; [(Ident, Port)] -&gt; [(Ident, Port)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; Port -&gt; [(Ident, Port)]
</span><a href="Synthesis.Builder.html#bindIfVar"><span class="hs-identifier hs-var">bindIfVar</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679182084"><span class="hs-identifier hs-var">p2</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182086"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>  </span><span class="annot"><a href="Syntax.html#PList"><span class="hs-identifier hs-type">PList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-671"></span><span>    </span><span id="local-6989586621679182090"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182090"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#isNilP"><span class="hs-identifier hs-var">isNilP</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182081"><span class="hs-identifier hs-var">scr</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Port, [(Ident, Port)]) -&gt; Build (Port, [(Ident, Port)])
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182090"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-672"></span><span>  </span><span class="annot"><a href="Syntax.html#PList"><span class="hs-identifier hs-type">PList</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679182091"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679182091"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-673"></span><span>    </span><span id="local-6989586621679182092"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182092"><span class="hs-identifier hs-var">nz</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#notP"><span class="hs-identifier hs-var">notP</span></a></span><span> </span><span class="annot"><span class="annottext">(Port -&gt; Build Port) -&gt; Build Port -&gt; Build Port
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#isNilP"><span class="hs-identifier hs-var">isNilP</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182081"><span class="hs-identifier hs-var">scr</span></a></span><span>
</span><span id="line-674"></span><span>    </span><span id="local-6989586621679182094"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182094"><span class="hs-identifier hs-var">tl</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#sndDec"><span class="hs-identifier hs-var">sndDec</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182081"><span class="hs-identifier hs-var">scr</span></a></span><span>
</span><span id="line-675"></span><span>    </span><span id="local-6989586621679182095"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182095"><span class="hs-identifier hs-var">isTl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#isNilP"><span class="hs-identifier hs-var">isNilP</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182094"><span class="hs-identifier hs-var">tl</span></a></span><span>
</span><span id="line-676"></span><span>    </span><span id="local-6989586621679182096"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182096"><span class="hs-identifier hs-var">g</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#andP"><span class="hs-identifier hs-var">andP</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182092"><span class="hs-identifier hs-var">nz</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182095"><span class="hs-identifier hs-var">isTl</span></a></span><span>
</span><span id="line-677"></span><span>    </span><span id="local-6989586621679182097"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182097"><span class="hs-identifier hs-var">hd</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#fstDec"><span class="hs-identifier hs-var">fstDec</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182081"><span class="hs-identifier hs-var">scr</span></a></span><span>
</span><span id="line-678"></span><span>    </span><span class="annot"><span class="annottext">(Port, [(Ident, Port)]) -&gt; Build (Port, [(Ident, Port)])
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182096"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; Port -&gt; [(Ident, Port)]
</span><a href="Synthesis.Builder.html#bindIfVar"><span class="hs-identifier hs-var">bindIfVar</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679182091"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182097"><span class="hs-identifier hs-var">hd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span>  </span><span class="annot"><a href="Syntax.html#PCons"><span class="hs-identifier hs-type">PCons</span></a></span><span> </span><span id="local-6989586621679182099"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679182099"><span class="hs-identifier hs-var">ph</span></a></span></span><span> </span><span id="local-6989586621679182100"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679182100"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-680"></span><span>    </span><span id="local-6989586621679182101"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182101"><span class="hs-identifier hs-var">nz</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#notP"><span class="hs-identifier hs-var">notP</span></a></span><span> </span><span class="annot"><span class="annottext">(Port -&gt; Build Port) -&gt; Build Port -&gt; Build Port
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#isNilP"><span class="hs-identifier hs-var">isNilP</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182081"><span class="hs-identifier hs-var">scr</span></a></span><span>
</span><span id="line-681"></span><span>    </span><span id="local-6989586621679182102"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182102"><span class="hs-identifier hs-var">hd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#fstDec"><span class="hs-identifier hs-var">fstDec</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182081"><span class="hs-identifier hs-var">scr</span></a></span><span>
</span><span id="line-682"></span><span>    </span><span id="local-6989586621679182103"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182103"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#sndDec"><span class="hs-identifier hs-var">sndDec</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182081"><span class="hs-identifier hs-var">scr</span></a></span><span>
</span><span id="line-683"></span><span>    </span><span class="annot"><span class="annottext">(Port, [(Ident, Port)]) -&gt; Build (Port, [(Ident, Port)])
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182101"><span class="hs-identifier hs-var">nz</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; Port -&gt; [(Ident, Port)]
</span><a href="Synthesis.Builder.html#bindIfVar"><span class="hs-identifier hs-var">bindIfVar</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679182099"><span class="hs-identifier hs-var">ph</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182102"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="annot"><span class="annottext">[(Ident, Port)] -&gt; [(Ident, Port)] -&gt; [(Ident, Port)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; Port -&gt; [(Ident, Port)]
</span><a href="Synthesis.Builder.html#bindIfVar"><span class="hs-identifier hs-var">bindIfVar</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679182100"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182103"><span class="hs-identifier hs-var">tl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>  </span><span class="annot"><span class="annottext">Pattern
</span><a href="Syntax.html#PWildcard"><span class="hs-identifier hs-var">PWildcard</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Build Port
</span><a href="Synthesis.Builder.html#trueP"><span class="hs-identifier hs-var">trueP</span></a></span><span> </span><span class="annot"><span class="annottext">Build Port
-&gt; (Port -&gt; Build (Port, [(Ident, Port)]))
-&gt; Build (Port, [(Ident, Port)])
forall a b. Build a -&gt; (a -&gt; Build b) -&gt; Build b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679182105"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182105"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Port, [(Ident, Port)]) -&gt; Build (Port, [(Ident, Port)])
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182105"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>  </span><span class="annot"><a href="Syntax.html#PVar"><span class="hs-identifier hs-type">PVar</span></a></span><span> </span><span id="local-6989586621679182107"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679182107"><span class="hs-identifier hs-var">x</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Build Port
</span><a href="Synthesis.Builder.html#trueP"><span class="hs-identifier hs-var">trueP</span></a></span><span> </span><span class="annot"><span class="annottext">Build Port
-&gt; (Port -&gt; Build (Port, [(Ident, Port)]))
-&gt; Build (Port, [(Ident, Port)])
forall a b. Build a -&gt; (a -&gt; Build b) -&gt; Build b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679182108"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182108"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Port, [(Ident, Port)]) -&gt; Build (Port, [(Ident, Port)])
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182108"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679182107"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182081"><span class="hs-identifier hs-var">scr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>  </span><span class="annot"><a href="Syntax.html#PLit"><span class="hs-identifier hs-type">PLit</span></a></span><span> </span><span id="local-6989586621679182110"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621679182110"><span class="hs-identifier hs-var">lit</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679182111"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182111"><span class="hs-identifier hs-var">litP</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Build Port
</span><a href="Synthesis.Builder.html#litNode%27"><span class="hs-identifier hs-var">litNode'</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621679182110"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-687"></span><span>                  </span><span id="local-6989586621679182113"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182113"><span class="hs-identifier hs-var">eq</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; DNode -&gt; Port -&gt; Port -&gt; Build Port
</span><a href="Synthesis.Builder.html#bin2"><span class="hs-identifier hs-var">bin2</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;equal&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; DNode
</span><a href="Node.html#NEqual"><span class="hs-identifier hs-var">NEqual</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182081"><span class="hs-identifier hs-var">scr</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182111"><span class="hs-identifier hs-var">litP</span></a></span><span>
</span><span id="line-688"></span><span>                  </span><span class="annot"><span class="annottext">(Port, [(Ident, Port)]) -&gt; Build (Port, [(Ident, Port)])
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182113"><span class="hs-identifier hs-var">eq</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-689"></span><span>  </span><span class="annot"><span class="annottext">Pattern
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Build Port
</span><a href="Synthesis.Builder.html#trueP"><span class="hs-identifier hs-var">trueP</span></a></span><span> </span><span class="annot"><span class="annottext">Build Port
-&gt; (Port -&gt; Build (Port, [(Ident, Port)]))
-&gt; Build (Port, [(Ident, Port)])
forall a b. Build a -&gt; (a -&gt; Build b) -&gt; Build b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679182114"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182114"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Port, [(Ident, Port)]) -&gt; Build (Port, [(Ident, Port)])
forall a. a -&gt; Build a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182114"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-690"></span><span>
</span><span id="line-691"></span><span class="annot"><span class="hs-comment">-- | Bind @x@ if the pattern is 'PVar'; otherwise no bindings.</span></span><span>
</span><span id="line-692"></span><span class="annot"><a href="Synthesis.Builder.html#bindIfVar"><span class="hs-identifier hs-type">bindIfVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-693"></span><span id="bindIfVar"><span class="annot"><span class="annottext">bindIfVar :: Pattern -&gt; Port -&gt; [(Ident, Port)]
</span><a href="Synthesis.Builder.html#bindIfVar"><span class="hs-identifier hs-var hs-var">bindIfVar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Syntax.html#PVar"><span class="hs-identifier hs-type">PVar</span></a></span><span> </span><span id="local-6989586621679182115"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679182115"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679182116"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182116"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679182115"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621679182116"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-694"></span><span class="annot"><a href="Synthesis.Builder.html#bindIfVar"><span class="hs-identifier hs-var">bindIfVar</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><span class="hs-identifier">_</span></span><span>        </span><span class="annot"><span class="annottext">Port
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span class="annot"><span class="hs-comment">-- | Literal helper that defers to 'litNode'.</span></span><span>
</span><span id="line-697"></span><span class="annot"><a href="Synthesis.Builder.html#litNode%27"><span class="hs-identifier hs-type">litNode'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Syntax.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Synthesis.Builder.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span> </span><span class="annot"><a href="Port.html#Port"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-698"></span><span id="litNode%27"><span class="annot"><span class="annottext">litNode' :: Literal -&gt; Build Port
</span><a href="Synthesis.Builder.html#litNode%27"><span class="hs-identifier hs-var hs-var">litNode'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Build Port
</span><a href="Synthesis.Builder.html#litNode"><span class="hs-identifier hs-var">litNode</span></a></span><span>
</span><span id="line-699"></span></pre></body></html>